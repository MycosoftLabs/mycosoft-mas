# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge














# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge














# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge

















# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge














# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge














# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge













# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge












# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge











# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge








# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge







# Mycosoft Essential Services
# Runs: MAS, Website, MINDEX integration, NatureOS, MycoBrain
# Usage: docker compose -f docker-compose.essential.yml up -d

version: "3.9"

services:
  # ============================================
  # INFRASTRUCTURE SERVICES
  # ============================================
  
  postgres:
    image: postgres:17-alpine
    container_name: mycosoft-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-mas}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-maspassword}
      POSTGRES_DB: ${POSTGRES_DB:-mas}
      PGDATA: /var/lib/postgresql/data/pgdata
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -h localhost -U ${POSTGRES_USER:-mas}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  redis:
    image: redis:8-alpine
    container_name: mycosoft-redis
    ports:
      - "6390:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - mycosoft-network
    restart: unless-stopped

  qdrant:
    image: qdrant/qdrant:v1.13.2
    container_name: mycosoft-qdrant
    ports:
      - "6345:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    healthcheck:
      test: ["CMD", "bash", "-c", "timeout 5 bash -c 'echo > /dev/tcp/localhost/6333' >/dev/null 2>&1"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCOSOFT MAS - Multi-Agent System
  # ============================================
  
  mas-orchestrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: runtime
    container_name: mycosoft-mas-orchestrator
    command: >
      sh -c "uvicorn mycosoft_mas.core.main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8001:8000"
    environment:
      MAS_ENV: development
      DEBUG_MODE: "true"
      LOG_LEVEL: DEBUG
      MAS_LIGHT_IMPORT: "1"
      REDIS_URL: redis://redis:6379/0
      DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
      QDRANT_URL: http://qdrant:6333
      LLM_API_KEY: ${LLM_API_KEY:-sk-placeholder}
      MINDEX_DATABASE_URL: ${MINDEX_DATABASE_URL:-}
      N8N_WEBHOOK_URL: http://n8n:5678
      TTS_URL: http://openedai-speech:8000
      WHISPER_URL: http://whisper:8000
      PYTHONPATH: /app
    volumes:
      - ./logs:/app/logs
      - ./data:/app/data
      - ./mycosoft_mas:/app/mycosoft_mas
    depends_on:
      redis:
        condition: service_healthy
      postgres:
        condition: service_healthy
      qdrant:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - mycosoft-network
    restart: unless-stopped

  # Agent managers are optional - core orchestrator handles most functionality
  # Uncomment when agent management modules are ready
  # mas-agent-manager:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     target: runtime
  #   container_name: mycosoft-agent-manager
  #   command: >
  #     sh -c "python -m mycosoft_mas.agents.agent_manager"
  #   environment:
  #     MAS_ENV: development
  #     REDIS_URL: redis://redis:6379/0
  #     DATABASE_URL: postgresql://mas:maspassword@postgres:5432/mas
  #   depends_on:
  #     mas-orchestrator:
  #       condition: service_started
  #   networks:
  #     - mycosoft-network

  # ============================================
  # N8N WORKFLOWS
  # ============================================
  
  n8n:
    image: n8nio/n8n:latest
    container_name: mycosoft-n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - GENERIC_TIMEZONE=America/New_York
      - N8N_ENCRYPTION_KEY=${N8N_ENCRYPTION_KEY:-myca-encryption-key-change-me}
      - N8N_PUBLIC_API_DISABLED=false
      - EXECUTIONS_MODE=regular
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - WHISPER_URL=http://whisper:8000
      - TTS_URL=http://openedai-speech:8000
    volumes:
      - n8n_data:/home/node/.n8n
      - ./n8n/workflows:/import/workflows
      - ./n8n/scripts:/import/scripts:ro
    depends_on:
      - redis
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # VOICE SERVICES
  # ============================================
  
  whisper:
    image: fedirz/faster-whisper-server:latest-cpu
    container_name: mycosoft-whisper
    ports:
      - "8765:8000"
    environment:
      - WHISPER__MODEL=Systran/faster-whisper-base.en
      - WHISPER__INFERENCE_DEVICE=cpu
    volumes:
      - whisper_models:/root/.cache/huggingface
    networks:
      - mycosoft-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || curl -f http://localhost:8000/ || exit 0"]
      interval: 60s
      timeout: 30s
      retries: 5
      start_period: 120s

  openedai-speech:
    image: ghcr.io/matatonic/openedai-speech:latest
    container_name: mycosoft-tts
    ports:
      - "5500:8000"
    environment:
      - TTS_HOME=/data
      - HF_HOME=/data
    volumes:
      - openedai_speech_data:/data
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MAS DASHBOARD (NatureOS MAS Integration)
  # ============================================
  
  unifi-dashboard:
    build:
      context: ./unifi-dashboard
      dockerfile: Dockerfile
    container_name: mycosoft-mas-dashboard
    ports:
      - "3100:3000"
    environment:
      NODE_ENV: production
      MAS_BACKEND_URL: http://mas-orchestrator:8000
      N8N_JARVIS_URL: http://n8n:5678/webhook/myca/jarvis
      N8N_WEBHOOK_URL: http://n8n:5678/webhook/myca/speech
      N8N_TTS_URL: http://n8n:5678/webhook/myca/speech/tts
      OPENEDAI_SPEECH_URL: http://openedai-speech:8000/v1/audio/speech
    networks:
      - mycosoft-network
    restart: unless-stopped

  # ============================================
  # MYCA NEXT.JS APP (MINDEX/NatureOS)
  # ============================================
  
  myca-app:
    build:
      context: .
      dockerfile: Dockerfile.next
      target: runner
    container_name: mycosoft-myca-app
    ports:
      - "3001:3000"
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8001
      MAS_API_URL: http://mas-orchestrator:8000
    volumes:
      - ./app:/app/app
      - ./components:/app/components
      - ./lib:/app/lib
      - ./public:/app/public
      - ./styles:/app/styles
    depends_on:
      mas-orchestrator:
        condition: service_started
    networks:
      - mycosoft-network
    restart: unless-stopped

volumes:
  redis_data:
  postgres_data:
  qdrant_data:
  n8n_data:
  whisper_models:
  openedai_speech_data:

networks:
  mycosoft-network:
    driver: bridge


















