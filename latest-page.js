(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8098],{57487:(e,s,a)=>{Promise.resolve().then(a.bind(a,27531))},27531:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>eG});var t=a(95155),n=a(45020),l=a(55367),i=a(12115),r=a(63230),c=a(35007),d=a(14085),o=a(89592),m=a(3392),x=a(99257),u=a(21773),h=a(44857),p=a(38684),j=a(29191),g=a(73239),v=a(75340),f=a(96609);function N(){var e;let[s,a]=(0,i.useState)([]),[n,l]=(0,i.useState)([]),[r,N]=(0,i.useState)(""),[b,y]=(0,i.useState)(""),[w,C]=(0,i.useState)(!1),[S,A]=(0,i.useState)(0),[k,_]=(0,i.useState)(""),[T,R]=(0,i.useState)([]),[E,B]=(0,i.useState)(null),[M,O]=(0,i.useState)(!0);(0,i.useEffect)(()=>{z(),P()},[]);let z=async()=>{try{var e;let s=await fetch("/api/firmware?action=detect"),t=await s.json();a(t.devices||[]),(null===(e=t.devices)||void 0===e?void 0:e.find(e=>"COM4"===e.port))&&y("COM4")}catch(e){console.error("Failed to detect devices:",e)}},P=async()=>{try{var e;let s=await fetch("/api/firmware?action=list"),a=await s.json();l(a.firmware||[]),(null===(e=a.firmware)||void 0===e?void 0:e.length)>0&&N(a.firmware[0].name)}catch(e){console.error("Failed to list firmware:",e)}},L=e=>{R(s=>[...s.slice(-49),"[".concat(new Date().toLocaleTimeString(),"] ").concat(e)])},F=async()=>{if(!r){L("✗ No firmware selected");return}C(!0),A(0),_("Compiling..."),L("> Compiling ".concat(r,"..."));try{let e=await fetch("/api/firmware",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"compile",firmware:r,use_platformio:M})}),s=await e.json();A(100),s.success?(L("✓ Compilation successful"),_("Compilation complete")):(L("✗ Compilation failed: ".concat(s.error)),_("Compilation failed"))}catch(e){L("✗ Error: ".concat(e)),_("Error")}finally{C(!1)}},D=async()=>{if(!r||!b){L("✗ Firmware and port required");return}C(!0),A(0),_("Uploading..."),L("> Uploading ".concat(r," to ").concat(b,"..."));try{let e=await fetch("/api/firmware",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"upload",firmware:r,port:b,use_platformio:M})}),s=await e.json();A(100),s.success?(L("✓ Upload successful"),_("Upload complete")):(L("✗ Upload failed: ".concat(s.error)),_("Upload failed"))}catch(e){L("✗ Error: ".concat(e)),_("Error")}finally{C(!1)}},I=async()=>{if(!b){L("✗ Port required");return}C(!0),_("Testing..."),L("> Testing firmware on ".concat(b,"..."));try{let e=await fetch("/api/firmware",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"test",port:b})}),s=await e.json();s.success?(L("✓ Test passed"),_("Test passed")):(L("✗ Test failed: ".concat(s.error)),_("Test failed"))}catch(e){L("✗ Error: ".concat(e)),_("Error")}finally{C(!1)}},Z=async()=>{if(!r||!b){L("✗ Firmware and port required");return}C(!0),A(0),_("Starting full update..."),L("> Starting full firmware update: ".concat(r," -> ").concat(b));try{let s=await fetch("/api/firmware",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"full",firmware:r,port:b,use_platformio:M,test:!0})}),a=await s.json();if(A(100),a.success)try{let s=JSON.parse(a.output||"{}");if(B(s),s.compile_success&&s.upload_success&&s.test_success)L("✓ Full update successful"),_("Update complete - All tests passed");else{var e;L("⚠ Update completed with issues"),_("Update completed with issues"),(null===(e=s.errors)||void 0===e?void 0:e.length)>0&&s.errors.forEach(e=>L("  - ".concat(e)))}}catch(e){L("✓ Update completed"),_("Update complete")}else L("✗ Update failed: ".concat(a.error)),_("Update failed")}catch(e){L("✗ Error: ".concat(e)),_("Error")}finally{C(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5"}),"Firmware Manager"]}),(0,t.jsx)(c.BT,{children:"Compile, upload, and test MycoBrain firmware on ESP32 devices"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Build Tool:"}),(0,t.jsx)(d.$,{variant:M?"default":"outline",size:"sm",onClick:()=>O(!0),children:"PlatformIO"}),(0,t.jsx)(d.$,{variant:M?"outline":"default",size:"sm",onClick:()=>O(!1),children:"Arduino CLI"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Select Device:"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("select",{className:"flex-1 px-3 py-2 border rounded-md",value:b,onChange:e=>y(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select port..."}),s.map(e=>(0,t.jsxs)("option",{value:e.port,children:[e.port," - ",e.description]},e.port))]}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:z,children:(0,t.jsx)(u.A,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Select Firmware:"}),(0,t.jsxs)("select",{className:"w-full px-3 py-2 border rounded-md",value:r,onChange:e=>N(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select firmware..."}),n.map(e=>(0,t.jsxs)("option",{value:e.name,children:[e.name," (Side ",e.side,")"]},e.name))]})]}),w&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:k}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[S,"%"]})]}),(0,t.jsx)(o.k,{value:S})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsxs)(d.$,{onClick:F,disabled:w||!r,variant:"outline",children:[(0,t.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Compile"]}),(0,t.jsxs)(d.$,{onClick:D,disabled:w||!r||!b,variant:"outline",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Upload"]}),(0,t.jsxs)(d.$,{onClick:I,disabled:w||!b,variant:"outline",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Test"]}),(0,t.jsxs)(d.$,{onClick:Z,disabled:w||!r||!b,className:"bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Compile & Upload & Test"]})]}),E&&(0,t.jsxs)(c.Zp,{className:"bg-muted/50",children:[(0,t.jsx)(c.aR,{children:(0,t.jsx)(c.ZB,{className:"text-sm",children:"Last Update Result"})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[E.compile_success?(0,t.jsx)(g.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(v.A,{className:"h-4 w-4 text-red-500"}),(0,t.jsxs)("span",{children:["Compilation: ",E.compile_success?"Success":"Failed"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[E.upload_success?(0,t.jsx)(g.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(v.A,{className:"h-4 w-4 text-red-500"}),(0,t.jsxs)("span",{children:["Upload: ",E.upload_success?"Success":"Failed"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[E.test_success?(0,t.jsx)(g.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(v.A,{className:"h-4 w-4 text-red-500"}),(0,t.jsxs)("span",{children:["Test: ",E.test_success?"Passed":"Failed"]})]}),(null===(e=E.errors)||void 0===e?void 0:e.length)>0&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("p",{className:"font-medium text-red-500",children:"Errors:"}),(0,t.jsx)("ul",{className:"list-disc list-inside text-xs",children:E.errors.map((e,s)=>(0,t.jsx)("li",{children:e},s))})]})]})})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Output Console"]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsx)(m.F,{className:"h-64 w-full rounded-md border p-4 bg-black text-green-400 font-mono text-sm",children:0===T.length?(0,t.jsx)("p",{className:"text-muted-foreground",children:"No output yet..."}):T.map((e,s)=>(0,t.jsx)("div",{className:"mb-1",children:e},s))})})]})]})}var b=a(31010),y=a(9955),w=a(15785),C=a(31641),S=a(50745),A=a(39286),k=a(85160),_=a(14505),T=a(67072),R=a(6452),E=a(71406);let B=[{name:"Red",r:255,g:0,b:0},{name:"Green",r:0,g:255,b:0},{name:"Blue",r:0,g:0,b:255},{name:"Yellow",r:255,g:255,b:0},{name:"Cyan",r:0,g:255,b:255},{name:"Magenta",r:255,g:0,b:255},{name:"White",r:255,g:255,b:255},{name:"Off",r:0,g:0,b:0}],M=["solid","blink","breathe","rainbow","chase","sparkle"],O=[{id:"camera_ook",name:"Camera OOK",description:"On-Off Keying for camera detection"},{id:"camera_manchester",name:"Camera Manchester",description:"Manchester encoding for cameras"},{id:"spatial_sm",name:"Spatial Modulation",description:"LED array spatial patterns"}];function z(e){let{deviceId:s,onCommand:a}=e,[n,l]=(0,i.useState)({r:0,g:255,b:0}),[r,o]=(0,i.useState)(100),[m,x]=(0,i.useState)(!1),[u,h]=(0,i.useState)(null),[p,g]=(0,i.useState)("camera_ook"),[v,f]=(0,i.useState)(""),[N,z]=(0,i.useState)(10),[P,L]=(0,i.useState)(1),[F,D]=(0,i.useState)(!1),I=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(!0),h(null);try{let n=await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/led"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,...t})}),l=await n.json();h(l.success?"OK":l.error||"Failed"),null==a||a("led ".concat(e))}catch(e){h(String(e))}finally{x(!1)}},[s,a]),Z=(e,s,a)=>{l({r:e,g:s,b:a}),I("rgb",{r:e,g:s,b:a})},U=async()=>{D(!0),await I("optical_tx",{profile:p,payload:v,rate_hz:N,repeat:P})},$=async()=>{D(!1);try{await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/control"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peripheral:"led",action:"optical_stop"})})}catch(e){}};return(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)(k.A,{className:"h-5 w-5 text-yellow-500"}),"LED Control",m&&(0,t.jsx)(_.A,{className:"h-4 w-4 animate-spin ml-auto"}),u&&(0,t.jsx)(A.E,{variant:"OK"===u?"default":"destructive",className:"ml-auto",children:u})]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(C.Tabs,{defaultValue:"color",className:"space-y-4",children:[(0,t.jsxs)(C.TabsList,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(C.TabsTrigger,{value:"color",children:"Color"}),(0,t.jsx)(C.TabsTrigger,{value:"patterns",children:"Patterns"}),(0,t.jsx)(C.TabsTrigger,{value:"optical",children:"Optical TX"})]}),(0,t.jsxs)(C.TabsContent,{value:"color",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-lg border-2 shadow-inner",style:{backgroundColor:"rgb(".concat(n.r,", ").concat(n.g,", ").concat(n.b,")")}}),(0,t.jsx)("div",{className:"flex-1 space-y-2",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(w.J,{className:"text-xs text-muted-foreground",children:"R"}),(0,t.jsx)(b.A,{value:[n.r],onValueChange:e=>{let[s]=e;return l(e=>({...e,r:s}))},max:255,className:"[&_[role=slider]]:bg-red-500"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(w.J,{className:"text-xs text-muted-foreground",children:"G"}),(0,t.jsx)(b.A,{value:[n.g],onValueChange:e=>{let[s]=e;return l(e=>({...e,g:s}))},max:255,className:"[&_[role=slider]]:bg-green-500"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(w.J,{className:"text-xs text-muted-foreground",children:"B"}),(0,t.jsx)(b.A,{value:[n.b],onValueChange:e=>{let[s]=e;return l(e=>({...e,b:s}))},max:255,className:"[&_[role=slider]]:bg-blue-500"})]})]})})]}),(0,t.jsx)(d.$,{className:"w-full",onClick:()=>Z(n.r,n.g,n.b),disabled:m,children:"Apply Color"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:B.map(e=>(0,t.jsxs)(d.$,{variant:"outline",size:"sm",className:"h-8",onClick:()=>Z(e.r,e.g,e.b),disabled:m,children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full mr-1 border",style:{backgroundColor:"rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")")}}),e.name]},e.name))}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(w.J,{children:["Brightness: ",r,"%"]}),(0,t.jsx)(b.A,{value:[r],onValueChange:e=>{let[s]=e;return o(s)},max:100})]})]}),(0,t.jsx)(C.TabsContent,{value:"patterns",className:"space-y-4",children:(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:M.map(e=>(0,t.jsxs)(d.$,{variant:"outline",onClick:()=>I("pattern",{pattern:e}),disabled:m,children:[(0,t.jsx)(T.A,{className:"h-4 w-4 mr-2"}),e]},e))})}),(0,t.jsxs)(C.TabsContent,{value:"optical",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted/50 border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(R.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Optical Modem TX"}),(0,t.jsx)(A.E,{variant:F?"default":"secondary",className:"ml-auto",children:F?"Running":"Idle"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Transmit data via LED modulation for camera-based receivers"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{children:"Profile"}),(0,t.jsxs)(S.l6,{value:p,onValueChange:g,children:[(0,t.jsx)(S.bq,{children:(0,t.jsx)(S.yv,{})}),(0,t.jsx)(S.gC,{children:O.map(e=>(0,t.jsx)(S.eb,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{children:"Payload (text)"}),(0,t.jsx)(y.p,{value:v,onChange:e=>f(e.target.value),placeholder:"Enter message to transmit..."})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Rate (Hz): ",N]}),(0,t.jsx)(b.A,{value:[N],onValueChange:e=>{let[s]=e;return z(s)},min:1,max:100})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Repeat: ",P,"x"]}),(0,t.jsx)(b.A,{value:[P],onValueChange:e=>{let[s]=e;return L(s)},min:1,max:10})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.$,{className:"flex-1",onClick:U,disabled:m||F||!v,children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Start TX"]}),(0,t.jsxs)(d.$,{variant:"destructive",onClick:$,disabled:!F,children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Stop"]})]})]})]})]})})]})}var P=a(45220),L=a(16972);let F=[{id:"coin",name:"Coin",icon:"\uD83E\uDE99",description:"Coin pickup sound"},{id:"bump",name:"Bump",icon:"\uD83D\uDCA5",description:"Bump/collision sound"},{id:"power",name:"Power",icon:"⚡",description:"Power up sound"},{id:"1up",name:"1-Up",icon:"\uD83C\uDF44",description:"Extra life sound"},{id:"morgio",name:"Morgio",icon:"\uD83C\uDFB5",description:"SuperMorgIO jingle"}],D=[{id:"simple_fsk",name:"Simple FSK",description:"Basic frequency shift keying"},{id:"ggwave_like",name:"GGWave-like",description:"Audio data transmission"},{id:"dtmf",name:"DTMF",description:"Dual-tone multi-frequency"}];function I(e){let{deviceId:s,onCommand:a}=e,[n,l]=(0,i.useState)(!1),[r,o]=(0,i.useState)(null),[m,x]=(0,i.useState)(1e3),[u,h]=(0,i.useState)(200),[p,g]=(0,i.useState)("simple_fsk"),[v,f]=(0,i.useState)(""),[N,k]=(0,i.useState)(100),[T,B]=(0,i.useState)(1e3),[M,O]=(0,i.useState)(2e3),[z,I]=(0,i.useState)(1),[Z,U]=(0,i.useState)(!1),$=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(!0),o(null);try{let n=await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/buzzer"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e,...t})}),l=await n.json();o(l.success?"OK":l.error||"Failed"),null==a||a("buzzer ".concat(e))}catch(e){o(String(e))}finally{l(!1)}},[s,a]),J=e=>{$("preset",{preset:e})},W=async()=>{U(!0),await $("acoustic_tx",{profile:p,payload:v,symbol_ms:N,f0:T,f1:M,repeat:z})},q=async()=>{U(!1),await $("stop",{})};return(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)(P.A,{className:"h-5 w-5 text-purple-500"}),"Buzzer Control",n&&(0,t.jsx)(_.A,{className:"h-4 w-4 animate-spin ml-auto"}),r&&(0,t.jsx)(A.E,{variant:"OK"===r?"default":"destructive",className:"ml-auto",children:r})]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(C.Tabs,{defaultValue:"presets",className:"space-y-4",children:[(0,t.jsxs)(C.TabsList,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(C.TabsTrigger,{value:"presets",children:"Presets"}),(0,t.jsx)(C.TabsTrigger,{value:"tone",children:"Custom Tone"}),(0,t.jsx)(C.TabsTrigger,{value:"acoustic",children:"Acoustic TX"})]}),(0,t.jsx)(C.TabsContent,{value:"presets",className:"space-y-4",children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:F.map(e=>(0,t.jsxs)(d.$,{variant:"outline",className:"h-auto py-3 flex flex-col items-center gap-1",onClick:()=>J(e.id),disabled:n,children:[(0,t.jsx)("span",{className:"text-2xl",children:e.icon}),(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]},e.id))})}),(0,t.jsx)(C.TabsContent,{value:"tone",className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Frequency: ",m," Hz"]}),(0,t.jsx)(b.A,{value:[m],onValueChange:e=>{let[s]=e;return x(s)},min:100,max:8e3,step:50}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[(0,t.jsx)("span",{children:"100 Hz"}),(0,t.jsx)("span",{children:"8000 Hz"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Duration: ",u," ms"]}),(0,t.jsx)(b.A,{value:[u],onValueChange:e=>{let[s]=e;return h(s)},min:50,max:2e3,step:50}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[(0,t.jsx)("span",{children:"50 ms"}),(0,t.jsx)("span",{children:"2000 ms"})]})]}),(0,t.jsxs)(d.$,{className:"w-full",onClick:()=>{$("tone",{hz:m,ms:u})},disabled:n,children:[(0,t.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Play Tone"]})]})}),(0,t.jsxs)(C.TabsContent,{value:"acoustic",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted/50 border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(R.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:"Acoustic Modem TX"}),(0,t.jsx)(A.E,{variant:Z?"default":"secondary",className:"ml-auto",children:Z?"Running":"Idle"})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Transmit data via audio modulation for microphone-based receivers"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{children:"Profile"}),(0,t.jsxs)(S.l6,{value:p,onValueChange:g,children:[(0,t.jsx)(S.bq,{children:(0,t.jsx)(S.yv,{})}),(0,t.jsx)(S.gC,{children:D.map(e=>(0,t.jsx)(S.eb,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{children:"Payload (text)"}),(0,t.jsx)(y.p,{value:v,onChange:e=>f(e.target.value),placeholder:"Enter message to transmit..."})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-xs",children:["Symbol: ",N,"ms"]}),(0,t.jsx)(b.A,{value:[N],onValueChange:e=>{let[s]=e;return k(s)},min:10,max:500})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-xs",children:["F0: ",T,"Hz"]}),(0,t.jsx)(b.A,{value:[T],onValueChange:e=>{let[s]=e;return B(s)},min:200,max:4e3})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-xs",children:["F1: ",M,"Hz"]}),(0,t.jsx)(b.A,{value:[M],onValueChange:e=>{let[s]=e;return O(s)},min:200,max:4e3})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Repeat: ",z,"x"]}),(0,t.jsx)(b.A,{value:[z],onValueChange:e=>{let[s]=e;return I(s)},min:1,max:10})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.$,{className:"flex-1",onClick:W,disabled:n||Z||!v,children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Start TX"]}),(0,t.jsxs)(d.$,{variant:"destructive",onClick:q,disabled:!Z,children:[(0,t.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Stop"]})]})]})]})]})})]})}var Z=a(95027),U=a(88485),$=a(26164),J=a(14275),W=a(81190),q=a(87725),V=a(88032),H=a(23888),G=a(86835),X=a(610),K=a(91544);let Y={thermometer:(0,t.jsx)(Z.A,{className:"h-5 w-5"}),monitor:(0,t.jsx)(U.A,{className:"h-5 w-5"}),mic:(0,t.jsx)($.A,{className:"h-5 w-5"}),radar:(0,t.jsx)(J.A,{className:"h-5 w-5"}),camera:(0,t.jsx)(W.A,{className:"h-5 w-5"}),sun:(0,t.jsx)(q.A,{className:"h-5 w-5"}),vibrate:(0,t.jsx)(V.A,{className:"h-5 w-5"}),lightbulb:(0,t.jsx)(H.A,{className:"h-5 w-5"}),"help-circle":(0,t.jsx)(G.A,{className:"h-5 w-5"})};function Q(e){let{peripheral:s,sensorData:a}=e,n=a||{},l=parseInt(s.address,16),i={blue:{bg:"bg-blue-500/20",border:"border-blue-500/20",text:"text-blue-500",icon:"text-blue-500"},purple:{bg:"bg-purple-500/20",border:"border-purple-500/20",text:"text-purple-500",icon:"text-purple-500"}},r=i[118===l||l%2==0?"blue":"purple"]||i.blue;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"p-4 rounded-lg bg-orange-500/10 border border-orange-500/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4 text-orange-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Temperature"})]}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:["number"==typeof n.temperature?n.temperature.toFixed(1):"--","\xb0C"]})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(X.A,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Humidity"})]}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:["number"==typeof n.humidity?n.humidity.toFixed(1):"--","%"]})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg bg-purple-500/10 border border-purple-500/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(K.A,{className:"h-4 w-4 text-purple-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Pressure"})]}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:["number"==typeof n.pressure?n.pressure.toFixed(0):"--",(0,t.jsx)("span",{className:"text-xs font-normal ml-1",children:"hPa"})]})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg ".concat(r.bg," border ").concat(r.border),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(H.A,{className:"h-4 w-4 ".concat(r.icon)}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Air Quality"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold ".concat(r.text),children:"number"==typeof n.iaq?n.iaq.toFixed(0):"--"}),"number"==typeof n.iaq_accuracy&&(0,t.jsxs)(A.E,{variant:"outline",className:"text-xs mt-1",children:["acc: ",n.iaq_accuracy]})]})]}),"number"==typeof n.gas_resistance&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm mb-1",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Gas Resistance"}),(0,t.jsxs)("span",{className:"font-mono",children:[(n.gas_resistance/1e3).toFixed(1)," kΩ"]})]}),(0,t.jsx)(o.k,{value:Math.min(100,n.gas_resistance/1e5*100),className:"h-2"})]}),(0,t.jsxs)("div",{className:"flex gap-4 text-sm",children:["number"==typeof n.voc&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"VOC:"})," ",(0,t.jsxs)("span",{className:"font-medium",children:[n.voc.toFixed(2)," ppm"]})]}),"number"==typeof n.co2eq&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"CO₂eq:"})," ",(0,t.jsxs)("span",{className:"font-medium",children:[n.co2eq.toFixed(0)," ppm"]})]})]})]})}function ee(e){let{sensorData:s}=e,a=s||{};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"text-center p-6 rounded-lg bg-muted/50",children:[(0,t.jsxs)("p",{className:"text-4xl font-bold",children:["number"==typeof a.distance_mm?(a.distance_mm/10).toFixed(1):"--",(0,t.jsx)("span",{className:"text-lg font-normal ml-1",children:"cm"})]}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm mt-2",children:"Distance"})]}),"number"==typeof a.signal_strength&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Signal Strength"}),(0,t.jsxs)("span",{children:[a.signal_strength,"%"]})]}),(0,t.jsx)(o.k,{value:a.signal_strength})]})]})}function es(e){let{deviceId:s}=e,[a,n]=(0,i.useState)(""),l=async()=>{try{await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/control"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peripheral:"display",action:"text",text:a})})}catch(e){}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"aspect-[2/1] rounded-lg bg-black border-2 border-gray-700 p-2",children:(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-green-400 font-mono text-sm",children:a||"OLED Display"})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:a,onChange:e=>n(e.target.value),placeholder:"Enter text...",className:"flex-1 px-3 py-2 border rounded-md text-sm"}),(0,t.jsx)(d.$,{onClick:l,size:"sm",children:"Send"})]})]})}function ea(e){let{peripheral:s}=e;return(0,t.jsxs)("div",{className:"text-center py-6",children:[(0,t.jsx)(G.A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),(0,t.jsxs)("p",{className:"text-muted-foreground",children:["Peripheral at ",s.address]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Type: ",s.type]}),(0,t.jsx)(A.E,{variant:"outline",className:"mt-2",children:"Awaiting data plane"})]})}function et(e){let{deviceId:s,peripheral:a,sensorData:n}=e,[l,r]=(0,i.useState)(!1),d=Y[a.widget.icon]||Y["help-circle"],o=parseInt(a.address,16),m={blue:{bg:"bg-blue-500/20",border:"border-blue-500/20",text:"text-blue-500",icon:"text-blue-500"},purple:{bg:"bg-purple-500/20",border:"border-purple-500/20",text:"text-purple-500",icon:"text-purple-500"}},x=m[o%2==0?"blue":"purple"]||m.blue,u=n&&Object.keys(n).length>0;return(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg ".concat(x.bg),children:(0,t.jsx)("div",{className:x.icon,children:d})}),(0,t.jsx)("span",{className:"capitalize",children:a.type.replace(/_/g," ")})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[u&&(0,t.jsxs)(A.E,{variant:"outline",className:"text-green-500",children:[(0,t.jsx)(H.A,{className:"h-3 w-3 mr-1 animate-pulse"}),"Live"]}),(0,t.jsx)(A.E,{variant:"outline",className:"font-mono text-xs",children:a.address})]})]})}),(0,t.jsx)(c.Wu,{children:(()=>{switch(a.widget.widget){case"environmental_sensor":return(0,t.jsx)(Q,{peripheral:a,sensorData:n});case"lidar":return(0,t.jsx)(ee,{sensorData:n});case"display":return(0,t.jsx)(es,{deviceId:s});default:return(0,t.jsx)(ea,{peripheral:a})}})()})]})}function en(e){let{deviceId:s,sensorData:a}=e,[n,l]=(0,i.useState)([]),[r,c]=(0,i.useState)(!1),[o,m]=(0,i.useState)(null),x=async()=>{c(!0),m(null);try{let e=await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/peripherals")),a=await e.json();a.peripherals&&l(a.peripherals),a.error&&m(a.error)}catch(e){m(String(e))}finally{c(!1)}};(0,i.useEffect)(()=>{x();let e=setInterval(x,5e3);return()=>clearInterval(e)},[s]);let h=e=>{var s,t;if(null==a?void 0:a[e.address])return a[e.address];if("bme688"===e.type||(null===(s=e.type)||void 0===s?void 0:s.includes("bme"))){let s=parseInt(e.address,16);return(null==a?void 0:a.bme688_1)&&(118===s||0===n.findIndex(e=>"bme688"===e.type))?a.bme688_1:(null==a?void 0:a.bme688_2)&&(119===s||1===n.findIndex(e=>"bme688"===e.type))?a.bme688_2:(null==a?void 0:a.bme688_1)||(null==a?void 0:a.bme688_2)}let l=null===(t=e.type)||void 0===t?void 0:t.toLowerCase().replace(/[^a-z0-9]/g,"_");if(l&&(null==a?void 0:a[l]))return a[l]};return r?(0,t.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,t.jsx)(_.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-2 text-muted-foreground",children:"Scanning peripherals..."})]}):0===n.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(J.A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No peripherals detected"}),(0,t.jsxs)(d.$,{variant:"outline",onClick:x,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Scan Again"]}),o&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-2",children:o})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[n.length," peripheral(s) detected"]}),(0,t.jsxs)(d.$,{variant:"ghost",size:"sm",onClick:x,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Rescan"]})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:n.map(e=>{let a=h(e);return(0,t.jsx)(et,{deviceId:s,peripheral:e,sensorData:a},e.address)})})]})}var el=a(86878),ei=a(22725);function er(e){let{data:s,color:a="currentColor",height:n=60}=e;if(s.length<2)return(0,t.jsx)("div",{className:"flex items-center justify-center text-muted-foreground text-xs",style:{height:n},children:"Collecting data..."});let l=Math.min(...s),i=Math.max(...s)-l||1,r=s.map((e,a)=>{let t=a/(s.length-1)*200,r=n-(e-l)/i*(n-10)-5;return"".concat(t,",").concat(r)}).join(" ");return(0,t.jsxs)("svg",{viewBox:"0 0 ".concat(200," ").concat(n),className:"w-full",style:{height:n},children:[(0,t.jsx)("polyline",{points:r,fill:"none",stroke:a,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),s.length>0&&(0,t.jsx)("circle",{cx:200,cy:n-(s[s.length-1]-l)/i*(n-10)-5,r:"3",fill:a})]})}function ec(e){var s;let{deviceId:a,pollInterval:n=2e3,maxPoints:l=50}=e,[r,o]=(0,i.useState)(!0),[m,x]=(0,i.useState)([]),[p,g]=(0,i.useState)("all"),[v,f]=(0,i.useState)(""),N=(0,i.useRef)(null),b=(0,i.useCallback)(async()=>{try{let e=await fetch("/api/mycobrain/".concat(encodeURIComponent(a),"/telemetry?count=").concat(l),{signal:AbortSignal.timeout(5e3)});if(e.ok){let s=await e.json();s.history&&(x(s.history),f(new Date().toLocaleTimeString()))}}catch(e){}},[a,l]);(0,i.useEffect)(()=>(r&&(b(),N.current=setInterval(b,n)),()=>{N.current&&clearInterval(N.current)}),[r,b,n]);let y=e=>m.filter(e=>"all"===p||e.sensor===p).map(s=>{let a=s.data[e];return"number"==typeof a?a:0}).slice(-l),w=[...new Set(m.map(e=>e.sensor))],C=(null===(s=m[m.length-1])||void 0===s?void 0:s.data)||{};return(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{className:"pb-3",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)(el.A,{className:"h-5 w-5 text-green-500"}),"Telemetry Charts",(0,t.jsx)(A.E,{variant:r?"default":"secondary",className:"ml-auto",children:r?"Live":"Paused"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsxs)(S.l6,{value:p,onValueChange:g,children:[(0,t.jsx)(S.bq,{className:"w-32 h-8",children:(0,t.jsx)(S.yv,{})}),(0,t.jsxs)(S.gC,{children:[(0,t.jsx)(S.eb,{value:"all",children:"All Sensors"}),w.map(e=>(0,t.jsx)(S.eb,{value:e,children:e.toUpperCase()},e))]})]}),(0,t.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>o(!r),children:r?(0,t.jsx)(ei.A,{className:"h-4 w-4"}):(0,t.jsx)(j.A,{className:"h-4 w-4"})}),(0,t.jsx)(d.$,{variant:"ghost",size:"sm",onClick:b,children:(0,t.jsx)(u.A,{className:"h-4 w-4"})}),(0,t.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>{let e=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="telemetry-".concat(a,"-").concat(Date.now(),".json"),t.click(),URL.revokeObjectURL(s)},children:(0,t.jsx)(h.A,{className:"h-4 w-4"})}),v&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:["Updated: ",v]})]})]}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4 text-red-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Temperature"}),(0,t.jsx)("span",{className:"ml-auto text-lg font-bold",children:"number"==typeof C.temperature?"".concat(C.temperature.toFixed(1),"\xb0C"):"--"})]}),(0,t.jsx)(er,{data:y("temperature"),color:"#ef4444"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(X.A,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Humidity"}),(0,t.jsx)("span",{className:"ml-auto text-lg font-bold",children:"number"==typeof C.humidity?"".concat(C.humidity.toFixed(1),"%"):"--"})]}),(0,t.jsx)(er,{data:y("humidity"),color:"#3b82f6"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(K.A,{className:"h-4 w-4 text-purple-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Pressure"}),(0,t.jsx)("span",{className:"ml-auto text-lg font-bold",children:"number"==typeof C.pressure?"".concat(C.pressure.toFixed(0)," hPa"):"--"})]}),(0,t.jsx)(er,{data:y("pressure"),color:"#a855f7"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(H.A,{className:"h-4 w-4 text-green-500"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Air Quality (IAQ)"}),(0,t.jsx)("span",{className:"ml-auto text-lg font-bold",children:"number"==typeof C.iaq?C.iaq.toFixed(0):"--"})]}),(0,t.jsx)(er,{data:y("iaq"),color:"#22c55e"})]})]}),(0,t.jsxs)("div",{className:"mt-4 text-center text-xs text-muted-foreground",children:[m.length," data points collected"]})]})]})}var ed=a(72581),eo=a(89282),em=a(26685),ex=a(81680),eu=a(68285),eh=a(38946),ep=a(13620),ej=a(35996),eg=a(37573),ev=a(96781),ef=a(28283),eN=a(36954),eb=a(86122);function ey(e){let{deviceId:s,onCommand:a}=e,[n,l]=(0,i.useState)(!1),[r,o]=(0,i.useState)(!0),[x,h]=(0,i.useState)(""),[p,j]=(0,i.useState)({connected:!0,frequency:915,spreadingFactor:7,rssi:-85,snr:9.5}),[g]=(0,i.useState)({connected:!1}),[v,f]=(0,i.useState)({enabled:!0,advertising:!0,connected:!1,deviceName:"MycoBoard"}),[N,b]=(0,i.useState)({enabled:!1,peers:0}),[S,k]=(0,i.useState)([]),T=e=>{k(s=>[{id:Math.random().toString(36).slice(2),timestamp:new Date().toISOString(),...e},...s.slice(0,49)])},E=(0,i.useCallback)(async()=>{if(x.trim()){l(!0),T({direction:"tx",protocol:"LoRa",message:x,status:"pending"});try{(await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/control"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peripheral:"lora",action:"send",message:x})})).ok?(T({direction:"tx",protocol:"LoRa",message:x,status:"success"}),null==a||a("lora send ".concat(x)),h("")):T({direction:"tx",protocol:"LoRa",message:x,status:"error"})}catch(e){T({direction:"tx",protocol:"LoRa",message:x,status:"error"})}finally{l(!1)}}},[s,x,a]),B=async()=>{l(!0);try{let e=await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/control"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peripheral:"lora",action:"status"})});if(e.ok){let s=await e.json();s.lora&&j(s.lora)}}catch(e){}finally{l(!1)}},M=e=>void 0===e?(0,t.jsx)(em.A,{className:"h-4 w-4 text-muted-foreground"}):e>-60?(0,t.jsx)(ex.A,{className:"h-4 w-4 text-green-500"}):e>-80?(0,t.jsx)(eu.A,{className:"h-4 w-4 text-yellow-500"}):(0,t.jsx)(eh.A,{className:"h-4 w-4 text-red-500"});return(0,t.jsxs)(c.Zp,{className:"h-full",children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2 text-base",children:[(0,t.jsx)(R.A,{className:"h-5 w-5 text-blue-500"}),"Communication",n&&(0,t.jsx)(_.A,{className:"h-4 w-4 animate-spin ml-auto"})]})}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)(C.Tabs,{defaultValue:"lora",className:"space-y-4",children:[(0,t.jsxs)(C.TabsList,{className:"grid w-full grid-cols-4",children:[(0,t.jsxs)(C.TabsTrigger,{value:"lora",className:"text-xs",children:[(0,t.jsx)(ep.A,{className:"h-3 w-3 mr-1"}),"LoRa"]}),(0,t.jsxs)(C.TabsTrigger,{value:"wifi",className:"text-xs",children:[(0,t.jsx)(ej.A,{className:"h-3 w-3 mr-1"}),"WiFi"]}),(0,t.jsxs)(C.TabsTrigger,{value:"ble",className:"text-xs",children:[(0,t.jsx)(eg.A,{className:"h-3 w-3 mr-1"}),"BLE"]}),(0,t.jsxs)(C.TabsTrigger,{value:"mesh",className:"text-xs",children:[(0,t.jsx)(ev.A,{className:"h-3 w-3 mr-1"}),"Mesh"]})]}),(0,t.jsxs)(C.TabsContent,{value:"lora",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ep.A,{className:"h-5 w-5 text-purple-500"}),(0,t.jsx)("span",{className:"font-medium",children:"LoRa Radio"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ed.d,{checked:r,onCheckedChange:o}),(0,t.jsx)(A.E,{variant:p.connected?"default":"secondary",children:p.connected?"Connected":"Disconnected"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Frequency:"}),(0,t.jsxs)("span",{className:"ml-2 font-mono",children:[p.frequency||"--"," MHz"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"SF:"}),(0,t.jsx)("span",{className:"ml-2 font-mono",children:p.spreadingFactor||"--"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"RSSI:"}),M(p.rssi),(0,t.jsxs)("span",{className:"font-mono",children:[p.rssi||"--"," dBm"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"SNR:"}),(0,t.jsxs)("span",{className:"ml-2 font-mono",children:[p.snr||"--"," dB"]})]})]}),(0,t.jsxs)(d.$,{variant:"ghost",size:"sm",className:"mt-2",onClick:B,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"Send LoRa Message"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(y.p,{value:x,onChange:e=>h(e.target.value),placeholder:"Enter message...",onKeyDown:e=>"Enter"===e.key&&E()}),(0,t.jsx)(d.$,{onClick:E,disabled:n||!x.trim(),children:(0,t.jsx)(ef.A,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>{h("PING")},children:"Ping"}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>{h("BEACON")},children:"Beacon"}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>{h("STATUS?")},children:"Query Status"})]})]}),(0,t.jsxs)(C.TabsContent,{value:"wifi",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ej.A,{className:"h-5 w-5 text-blue-500"}),(0,t.jsx)("span",{className:"font-medium",children:"WiFi"})]}),(0,t.jsx)(A.E,{variant:g.connected?"default":"secondary",children:g.connected?"Connected":"Disconnected"})]}),g.connected?(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"SSID:"}),(0,t.jsx)("span",{className:"ml-2 font-medium",children:g.ssid})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"IP:"}),(0,t.jsx)("span",{className:"ml-2 font-mono",children:g.ip})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Signal:"}),M(g.rssi),(0,t.jsxs)("span",{className:"font-mono",children:[g.rssi," dBm"]})]})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"WiFi not configured on this board"})]}),(0,t.jsx)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:"WiFi configuration coming soon"})]}),(0,t.jsxs)(C.TabsContent,{value:"ble",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eg.A,{className:"h-5 w-5 text-blue-600"}),(0,t.jsx)("span",{className:"font-medium",children:"Bluetooth LE"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ed.d,{checked:v.enabled,onCheckedChange:e=>f(s=>({...s,enabled:e}))}),(0,t.jsx)(A.E,{variant:v.connected?"default":"secondary",children:v.connected?"Paired":v.advertising?"Advertising":"Off"})]})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Device Name:"}),(0,t.jsx)("span",{className:"ml-2 font-medium",children:v.deviceName})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Advertising:"}),(0,t.jsx)(ed.d,{checked:v.advertising,onCheckedChange:e=>f(s=>({...s,advertising:e})),disabled:!v.enabled})]})]})]}),(0,t.jsxs)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:[(0,t.jsx)(eN.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"Connect via Bluetooth Serial or Nordic UART Service"]})]}),(0,t.jsxs)(C.TabsContent,{value:"mesh",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ev.A,{className:"h-5 w-5 text-green-500"}),(0,t.jsx)("span",{className:"font-medium",children:"ESP-NOW Mesh"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ed.d,{checked:N.enabled,onCheckedChange:e=>b(s=>({...s,enabled:e}))}),(0,t.jsx)(A.E,{variant:N.enabled?"default":"secondary",children:N.enabled?"".concat(N.peers," Peers"):"Disabled"})]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"ESP-NOW allows low-latency, connectionless communication between ESP32 devices."})]}),(0,t.jsxs)("div",{className:"text-center py-4 text-muted-foreground text-sm",children:[(0,t.jsx)(eb.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"Mesh networking coming soon"]})]})]}),(0,t.jsx)(eo.Separator,{className:"my-4"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)(w.J,{className:"text-sm",children:"Communication Log"}),(0,t.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>k([]),children:"Clear"})]}),(0,t.jsx)(m.F,{className:"h-32 rounded border bg-muted/30 p-2",children:0===S.length?(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center py-4",children:"No messages yet"}):(0,t.jsx)("div",{className:"space-y-1",children:S.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs font-mono",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:new Date(e.timestamp).toLocaleTimeString()}),(0,t.jsx)(A.E,{variant:"tx"===e.direction?"default":"secondary",className:"text-[10px] px-1",children:e.direction.toUpperCase()}),(0,t.jsx)(A.E,{variant:"outline",className:"text-[10px] px-1",children:e.protocol}),(0,t.jsx)("span",{className:"success"===e.status?"text-green-500":"error"===e.status?"text-red-500":"text-yellow-500",children:e.message})]},e.id))})})]})]})]})}var ew=a(81476),eC=a(66889),eS=a(57223);function eA(e){let{deviceId:s}=e,[a,n]=(0,i.useState)(null),[l,r]=(0,i.useState)(null),[o,m]=(0,i.useState)(!1),[x,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{h(),p();let e=setInterval(()=>{h(),p()},3e4);return()=>clearInterval(e)},[s]);let h=async()=>{try{let a=await fetch("/api/natureos/devices/mycobrain");if(a.ok){var e;let t=await a.json(),l=null===(e=t.devices)||void 0===e?void 0:e.find(e=>e.device_id===s);l&&n({registered:l.registered||!1,registered_at:l.registered_at,last_seen:l.last_seen,location:l.location,metadata:l.metadata})}}catch(e){console.error("Failed to load registration status:",e)}},p=async()=>{try{let t=await fetch("/api/mindex/telemetry?device_id=".concat(encodeURIComponent(s),"&limit=1"));if(t.ok){var e,a;let s=await t.json();r({count:s.count||0,latest:null===(a=s.telemetry)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.timestamp})}}catch(e){console.debug("Telemetry stats not available:",e)}},j=async()=>{u(!0);try{(await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_id:s,serial_number:s,firmware_version:"unknown"})})).ok&&await h()}catch(e){console.error("Failed to register device:",e)}finally{u(!1)}};return(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(ew.A,{className:"h-4 w-4"}),"MINDEX Integration"]})}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Registration:"}),(0,t.jsx)(A.E,{variant:(null==a?void 0:a.registered)?"default":"secondary",children:(null==a?void 0:a.registered)?"Registered":"Not Registered"})]}),!(null==a?void 0:a.registered)&&(0,t.jsx)(d.$,{size:"sm",variant:"outline",onClick:j,disabled:x,children:x?"Registering...":"Register"})]}),(null==a?void 0:a.registered)&&(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[a.registered_at&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(eC.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Registered: ",new Date(a.registered_at).toLocaleDateString()]})]}),a.last_seen&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(H.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Last seen: ",new Date(a.last_seen).toLocaleString()]})]}),a.location&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(eS.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{children:["Location: ",a.location.lat.toFixed(4),", ",a.location.lon.toFixed(4)]})]})]}),l&&l.count>0&&(0,t.jsx)("div",{className:"pt-2 border-t",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(H.A,{className:"h-3 w-3"}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[l.count," telemetry records in MINDEX"]})]})})]})]})}var ek=a(61594),e_=a(20994),eT=a(40886),eR=a(54216),eE=a(68149),eB=a(48686),eM=a(29119),eO=a(10001),ez=a(12792),eP=a(45686),eL=a(31836),eF=a(53938),eD=a(59136),eI=a(68236),eZ=a(15205),eU=a(23950),e$=a(79928),eJ=a(51032),eW=a(60650);function eq(){var e,s,a,n,l,o,h,p,j,y,S,_,E,B,M,O,L,F,D,U,$,J,W,q,V,G;let{initialPort:X}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{devices:K,loading:Y,error:Q,isConnected:ee,lastUpdate:es,refresh:ea,setNeoPixel:et,neoPixelRainbow:el,neoPixelOff:ei,buzzerBeep:er,buzzerMelody:ed,buzzerOff:em,sendControl:ex}=(0,r.oX)(2e3),[eu,eh]=(0,i.useState)(X||null),[ep,eg]=(0,i.useState)({r:0,g:255,b:0}),[ev,ef]=(0,i.useState)(128),[eN,eb]=(0,i.useState)(1e3),[ew,eC]=(0,i.useState)(null),[eS,eq]=(0,i.useState)([]),[eV,eH]=(0,i.useState)([]),eG=K.find(e=>e.port===eu)||K[0];(0,i.useEffect)(()=>{K.length>0&&(X&&K.find(e=>e.port===X)?eh(X):eu||eh(K[0].port))},[K,eu,X]),(0,i.useEffect)(()=>{var e,s,a,t;if(null==eG?void 0:null===(e=eG.sensor_data)||void 0===e?void 0:e.bme688_1){let e={timestamp:new Date,bme1_temp:eG.sensor_data.bme688_1.temperature||0,bme1_humidity:eG.sensor_data.bme688_1.humidity||0,bme1_iaq:eG.sensor_data.bme688_1.iaq||0,bme2_temp:(null===(s=eG.sensor_data.bme688_2)||void 0===s?void 0:s.temperature)||0,bme2_humidity:(null===(a=eG.sensor_data.bme688_2)||void 0===a?void 0:a.humidity)||0,bme2_iaq:(null===(t=eG.sensor_data.bme688_2)||void 0===t?void 0:t.iaq)||0};eH(s=>[...s.slice(-59),e])}},[null==eG?void 0:null===(s=eG.sensor_data)||void 0===s?void 0:null===(e=s.bme688_1)||void 0===e?void 0:e.temperature]);let eX=e=>{eq(s=>[...s.slice(-49),"[".concat(new Date().toLocaleTimeString(),"] ").concat(e)])},[eK,eY]=(0,i.useState)(!1),[eQ,e0]=(0,i.useState)(null),[e2,e5]=(0,i.useState)("checking"),[e4,e1]=(0,i.useState)([]),[e3,e8]=(0,i.useState)({}),[e6,e9]=(0,i.useState)([]),[e7,se]=(0,i.useState)(!1),[ss,sa]=(0,i.useState)(null),[st,sn]=(0,i.useState)(!1),sl=(0,i.useRef)(null),si=(0,i.useRef)(0),sr=async(e,s)=>{eC(e),eX("> Sending ".concat(e,"..."));try{await s(),eX("✓ ".concat(e," success"))}catch(s){eX("✗ ".concat(e," failed: ").concat(s))}finally{eC(null)}},sc=(0,i.useRef)(new Set);if((0,i.useEffect)(()=>{let e=async()=>{try{var e,s;let a=await fetch("/api/services/status",{signal:AbortSignal.timeout(6e3)});if(a.ok){let s=await a.json(),t=null===(e=s.services)||void 0===e?void 0:e.find(e=>"mycobrain"===e.id);t&&"online"===t.status&&e5("online")}let t=await fetch("/api/mycobrain",{signal:AbortSignal.timeout(8e3)}),n=await t.json(),l=!n.error||"MycoBrain service not running"!==n.error;if(e5(l?"online":"offline"),l)try{let e=await fetch("/api/mycobrain/ports",{signal:AbortSignal.timeout(8e3)}).catch(()=>null);if(null==e?void 0:e.ok){let a=await e.json();e1(a.ports||[]);let t={};null===(s=a.ports)||void 0===s||s.forEach(e=>{let s=e.path||e.port||e.id;s&&(t[s]="available")}),e8(t)}}catch(e){}}catch(s){let e=s instanceof Error?s.message:String(s);if((null==s?void 0:s.name)==="TimeoutError"||e.toLowerCase().includes("timeout")||e.toLowerCase().includes("timed out"))return;si.current+=1,sl.current!==e&&(sl.current=e,console.error("Service check error:",s)),si.current>=2&&e5("offline")}};e();let s=setInterval(e,3e4);return()=>clearInterval(s)},[]),(0,i.useEffect)(()=>{if("online"!==e2)return;let e=async()=>{try{let s=await fetch("/api/mycobrain/devices",{signal:AbortSignal.timeout(5e3)}).catch(()=>null),a=new Set;if(null==s?void 0:s.ok){var e;let t=await s.json();null===(e=t.devices)||void 0===e||e.forEach(e=>{e.port&&a.add(e.port)})}sc.current=a;let t=await fetch("/api/mycobrain/ports",{signal:AbortSignal.timeout(5e3)}).catch(()=>null);if(!(null==t?void 0:t.ok))return;let n=((await t.json()).ports||[]).filter(e=>{let s=e.path||e.port||e.id;return!(!s||a.has(s))&&(e.is_mycobrain||s.startsWith("COM")||s.startsWith("/dev/tty")||s.startsWith("/dev/cu.")||e.description&&(e.description.toLowerCase().includes("serial")||e.description.toLowerCase().includes("usb")||e.description.toLowerCase().includes("ch340")||e.description.toLowerCase().includes("cp210")||e.description.toLowerCase().includes("ftdi")||e.description.toLowerCase().includes("esp32")||e.description.toLowerCase().includes("mycoboard")||e.description.toLowerCase().includes("uart"))||s.match(/^(COM\d+|tty[A-Z]+\d+|cu\.[a-z]+)/i))});if(n.length>0&&!eK){let e=n[0],s=e.path||e.port||e.id;if(s&&!sc.current.has(s))try{let e=await fetch("/api/mycobrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"connect",port:s}),signal:AbortSignal.timeout(15e3)});if(!e.ok){console.debug("Auto-connect attempt failed for ".concat(s,": ").concat(e.status));return}let a=await e.json();if(a.success||"connected"===a.status||"already_connected"===a.status){sc.current.add(s),await ea(),eX("✓ Auto-connected to MycoBoard on ".concat(s));try{await fetch("/api/mycobrain/".concat(encodeURIComponent(s),"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_id:s,port:s,serial_number:"AUTO-".concat(Date.now()),firmware_version:"1.0.0"}),signal:AbortSignal.timeout(5e3)}).catch(()=>{})}catch(e){}}else console.debug("Connection result for ".concat(s,":"),a.status||a.error)}catch(e){console.debug("Auto-connect error for ".concat(s,":"),e)}}}catch(e){}};e();let s=setInterval(e,3e3);return()=>{clearTimeout(initialTimeout),clearInterval(s)}},[e2,eK,ea]),(0,i.useEffect)(()=>{if(!eG||!e7)return;let e=setInterval(async()=>{try{let e=await fetch("/api/mycobrain/".concat(eG.port,"/serial"),{signal:AbortSignal.timeout(5e3)});if(e.ok){let s=await e.json();s.data&&e9(e=>[...e.slice(-99),...s.data].slice(-100))}}catch(e){}},1e3);return()=>clearInterval(e)},[eG,e7]),Y&&0===K.length)return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(u.A,{className:"h-8 w-8 animate-spin text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading devices..."}),Q&&(0,t.jsx)("p",{className:"text-sm text-red-500 mt-2",children:Q})]});let sd=async()=>{eY(!0),e0(null),eX("> Scanning for MycoBrain devices...");try{let a=await fetch("/api/mycobrain"),t=await a.json();if(t.error){e0("MycoBrain service not running: ".concat(t.message)),eX("✗ Service error: ".concat(t.error));return}let n=await fetch("/api/mycobrain/ports");if(!n.ok){let e=await n.json().catch(()=>({}));e0("Failed to scan ports: ".concat(e.message||"Service unavailable")),eX("✗ Failed to get ports");return}let l=(await n.json()).ports||[];e1(l),eX("> Found ".concat(l.length," serial port(s)"));let i=l.find(e=>"COM5"===e.port),r=l.find(e=>"COM4"===e.port),c=l.filter(e=>{var s,a;return e.is_mycobrain||(null===(s=e.port)||void 0===s?void 0:s.startsWith("COM"))&&"COM4"!==e.port&&"COM5"!==e.port||(null===(a=e.port)||void 0===a?void 0:a.startsWith("/dev/tty"))}),d=i?[i,r,...c].filter(Boolean):r?[r,...c]:c;if(0===d.length){e0("No MycoBrain devices found. Make sure device is connected via USB."),eX("✗ No MycoBrain devices found");return}for(let a of d){let t=a.port;eX("> Attempting to connect to ".concat(t,"..."));try{var e,s;let a=await fetch("/api/mycobrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"connect",port:t}),signal:AbortSignal.timeout(15e3)}),n=await a.json();if(n.success||"connected"===n.status){e0("Successfully connected to ".concat(t,"!")),eX("✓ Connected to ".concat(t)),await new Promise(e=>setTimeout(e,500)),await ea();return}eX("✗ Connection failed: ".concat(n.message||n.error||n.detail)),((null===(e=n.error)||void 0===e?void 0:e.includes("locked"))||(null===(s=n.detail)||void 0===s?void 0:s.includes("locked")))&&e8(e=>({...e,[t]:"locked"}))}catch(e){"AbortError"===e.name?(eX("✗ Connection to ".concat(t," timed out (port may be locked)")),e8(e=>({...e,[t]:"locked"}))):eX("✗ Failed to connect to ".concat(t,": ").concat(e))}}e0("Found ports but could not connect. Check device is powered on and not in use by another application."),eX("✗ Could not connect to any device")}catch(e){e0("Scan failed: ".concat(e)),eX("✗ Scan error: ".concat(e))}finally{eY(!1)}},so=async e=>{eX("> ".concat(e.charAt(0).toUpperCase()+e.slice(1),"ing MycoBrain service..."));try{let s=await fetch("/api/services/mycobrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e}),signal:AbortSignal.timeout(1e4)}),a=await s.json();s.ok?(eX("✓ Service ".concat(e,"ed successfully")),e5("start"===e||"restart"===e?"online":"offline"),await new Promise(e=>setTimeout(e,2e3)),await ea()):eX("✗ Failed to ".concat(e," service: ").concat(a.error||a.message))}catch(s){eX("✗ Service ".concat(e," error: ").concat(s))}},sm=async()=>{eX("> Clearing port locks...");try{let e=await fetch("/api/mycobrain/ports/clear-locks",{method:"POST",signal:AbortSignal.timeout(1e4)}),s=await e.json();e.ok?(eX("✓ Port locks cleared"),e8({}),await sd()):eX("✗ Failed to clear locks: ".concat(s.error||s.message))}catch(e){eX("✗ Clear locks error: ".concat(e))}},sx=async()=>{eX("> Running diagnostics...");try{let e=(null==eG?void 0:eG.device_id)||eu||(null==eG?void 0:eG.port)||"all",s=await fetch("/api/mycobrain/".concat(encodeURIComponent(e),"/diagnostics"),{method:"GET",signal:AbortSignal.timeout(1e4)});if(s.ok){let e=await s.json();sa(e),eX("✓ Diagnostics complete")}else{let s=Object.entries(e3).map(e=>{let[s,a]=e;return"".concat(s,": ").concat(a)}).join(", ")||"None",a={service_status:e2,port_status:s,available_ports:e4.length,connected_devices:K.length,selected_port:e,timestamp:new Date().toISOString()};sa(a),eX("✓ Basic diagnostics complete")}}catch(t){let e=Object.entries(e3).map(e=>{let[s,a]=e;return"".concat(s,": ").concat(a)}).join(", ")||"None",s=t instanceof Error?t.message:String(t),a=(null==eG?void 0:eG.device_id)||eu||(null==eG?void 0:eG.port)||"unknown";sa({service_status:e2,port_status:e,available_ports:e4.length,connected_devices:K.length,selected_port:a,error:s,timestamp:new Date().toISOString()}),eX("⚠ Diagnostics completed with errors: ".concat(s))}};return eG?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(c.Zp,{className:"overflow-hidden",children:(0,t.jsxs)("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 bg-white/20 rounded-xl",children:(0,t.jsx)(x.A,{className:"h-8 w-8"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"MycoBrain Gateway"}),(0,t.jsxs)("p",{className:"text-green-100 flex items-center gap-2",children:[(0,t.jsx)(eE.A,{className:"h-4 w-4"}),eG.port,(0,t.jsx)("span",{className:"mx-1",children:"•"}),(0,t.jsxs)("span",{children:["MDP v",(null===(a=eG.device_info)||void 0===a?void 0:a.mdp_version)||1]})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,t.jsx)(A.E,{className:eG.connected?"bg-green-500":"bg-red-500",children:eG.connected?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ej.A,{className:"h-3 w-3 mr-1"}),"Connected"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eL.A,{className:"h-3 w-3 mr-1"}),"Disconnected"]})}),(0,t.jsxs)("span",{className:"text-xs text-green-100",children:["Last update: ",(null==es?void 0:es.toLocaleTimeString())||"—"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[(0,t.jsxs)("div",{className:"bg-white/10 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-100 mb-1",children:[(0,t.jsx)(eF.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Uptime"})]}),(0,t.jsx)("p",{className:"text-lg font-bold",children:(0,r.Y0)(null===(n=eG.device_info)||void 0===n?void 0:n.uptime)})]}),(0,t.jsxs)("div",{className:"bg-white/10 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-100 mb-1",children:[(0,t.jsx)(R.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"LoRa"})]}),(0,t.jsx)("p",{className:"text-lg font-bold",children:(null===(l=eG.device_info)||void 0===l?void 0:l.lora_status)==="ok"?"Active":"Init"})]}),(0,t.jsxs)("div",{className:"bg-white/10 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-100 mb-1",children:[(0,t.jsx)(eM.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Sensors"})]}),(0,t.jsx)("p",{className:"text-lg font-bold",children:"2x BME688"})]}),(0,t.jsxs)("div",{className:"bg-white/10 rounded-lg p-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-green-100 mb-1",children:[(0,t.jsx)(T.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-xs",children:"Status"})]}),(0,t.jsx)("p",{className:"text-lg font-bold capitalize",children:(null===(o=eG.device_info)||void 0===o?void 0:o.status)||"ready"})]})]})]})}),(0,t.jsxs)(C.Tabs,{defaultValue:"sensors",className:"space-y-6",children:[(0,t.jsxs)(C.TabsList,{className:"grid w-full grid-cols-7",children:[(0,t.jsxs)(C.TabsTrigger,{value:"sensors",className:"gap-2",children:[(0,t.jsx)(Z.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Sensors"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"controls",className:"gap-2",children:[(0,t.jsx)(k.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Controls"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"communication",className:"gap-2",children:[(0,t.jsx)(R.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Comms"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"analytics",className:"gap-2",children:[(0,t.jsx)(eD.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Analytics"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"console",className:"gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Console"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"config",className:"gap-2",children:[(0,t.jsx)(eI.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Config"})]}),(0,t.jsxs)(C.TabsTrigger,{value:"diagnostics",className:"gap-2",children:[(0,t.jsx)(ek.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Diagnostics"})]})]}),(0,t.jsx)(C.TabsContent,{value:"sensors",className:"space-y-6",children:eG&&(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(eZ.A,{className:"h-5 w-5"}),"Discovered Peripherals"]}),(0,t.jsx)(c.BT,{children:"Auto-detected I2C devices and peripherals via machine mode protocol"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsx)(en,{deviceId:eG.device_id||eG.port,sensorData:eG.sensor_data})})]})}),(0,t.jsxs)(C.TabsContent,{value:"controls",className:"space-y-6",children:[eG&&(0,t.jsxs)(c.Zp,{className:"border-dashed",children:[(0,t.jsxs)(c.aR,{className:"pb-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(T.A,{className:"h-4 w-4"}),"NDJSON Machine Mode Protocol"]}),(0,t.jsx)(A.E,{variant:st?"default":"secondary",children:st?"Active":"Not Initialized"})]}),(0,t.jsx)(c.BT,{children:st?"Machine mode is active. Use the widgets below for optical/acoustic modem and advanced controls.":"Click 'Initialize Machine Mode' below to enable NDJSON protocol features."})]}),!st&&(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(d.$,{variant:"outline",onClick:async()=>{eX("> Initializing machine mode...");try{let e=await fetch("/api/mycobrain/".concat(encodeURIComponent(eG.device_id||eG.port),"/machine-mode"),{method:"POST",signal:AbortSignal.timeout(1e4)}),s=await e.json();s.success?(sn(!0),eX("✓ Machine mode initialized"),await fetch("/api/mycobrain/".concat(encodeURIComponent(eG.device_id||eG.port),"/peripherals"),{method:"POST"}),eX("✓ Peripheral scan triggered")):(sn(!1),eX("✗ Machine mode failed: ".concat(s.error||"Unknown error")))}catch(e){sn(!1),eX("✗ Machine mode error: ".concat(e))}},children:[(0,t.jsx)(T.A,{className:"h-4 w-4 mr-2"}),"Initialize Machine Mode"]})})]}),eG&&st&&(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsx)(z,{deviceId:eG.device_id||eG.port,onCommand:eX}),(0,t.jsx)(I,{deviceId:eG.device_id||eG.port,onCommand:eX})]}),eG&&!st&&(0,t.jsx)(c.Zp,{className:"border-yellow-500/50 bg-yellow-500/5",children:(0,t.jsxs)(c.Wu,{className:"pt-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-yellow-600 dark:text-yellow-400",children:[(0,t.jsx)(eU.A,{className:"h-5 w-5"}),(0,t.jsx)("p",{className:"font-medium",children:"Machine Mode Not Active"})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"Initialize machine mode in the Diagnostics tab to unlock advanced features: optical modem TX, acoustic modem TX, and automatic peripheral discovery."})]})}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(k.A,{className:"h-5 w-5 text-yellow-500"}),"NeoPixel LED Control (Legacy)"]}),(0,t.jsx)(c.BT,{children:"Legacy MDP protocol controls"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.$,{className:"flex-1",onClick:()=>sr("neopixel-color",()=>et(eG.device_id||eG.port,ep.r,ep.g,ep.b,ev)),disabled:"neopixel-color"===ew,children:[(0,t.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"Set Color"]}),(0,t.jsxs)(d.$,{variant:"outline",className:"flex-1",onClick:()=>sr("neopixel-rainbow",()=>el(eG.device_id||eG.port)),disabled:"neopixel-rainbow"===ew,children:[(0,t.jsx)(e$.A,{className:"h-4 w-4 mr-2"}),"Rainbow"]}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("neopixel-off",()=>ei(eG.device_id||eG.port)),disabled:"neopixel-off"===ew,children:(0,t.jsx)(eJ.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-red-500",children:["Red: ",ep.r]}),(0,t.jsx)(b.A,{value:[ep.r],onValueChange:e=>{let[s]=e;return eg(e=>({...e,r:s}))},max:255,className:"mt-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-green-500",children:["Green: ",ep.g]}),(0,t.jsx)(b.A,{value:[ep.g],onValueChange:e=>{let[s]=e;return eg(e=>({...e,g:s}))},max:255,className:"mt-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{className:"text-blue-500",children:["Blue: ",ep.b]}),(0,t.jsx)(b.A,{value:[ep.b],onValueChange:e=>{let[s]=e;return eg(e=>({...e,b:s}))},max:255,className:"mt-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Brightness: ",Math.round(ev/255*100),"%"]}),(0,t.jsx)(b.A,{value:[ev],onValueChange:e=>{let[s]=e;return ef(s)},max:255,className:"mt-2"})]})]}),(0,t.jsx)("div",{className:"h-12 rounded-lg border-2",style:{backgroundColor:"rgb(".concat(ep.r,", ").concat(ep.g,", ").concat(ep.b,")"),opacity:ev/255}}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"mb-2 block",children:"Presets"}),(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:[{name:"Red",r:255,g:0,b:0},{name:"Green",r:0,g:255,b:0},{name:"Blue",r:0,g:0,b:255},{name:"Yellow",r:255,g:255,b:0},{name:"Cyan",r:0,g:255,b:255},{name:"Magenta",r:255,g:0,b:255},{name:"White",r:255,g:255,b:255},{name:"Warm",r:255,g:180,b:100}].map(e=>(0,t.jsx)(d.$,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",style:{backgroundColor:"rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")")},onClick:()=>eg({r:e.r,g:e.g,b:e.b}),title:e.name},e.name))})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(P.A,{className:"h-5 w-5 text-blue-500"}),"Buzzer Control"]}),(0,t.jsx)(c.BT,{children:"Audio feedback and alerts"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.$,{className:"flex-1",onClick:()=>sr("buzzer-beep",()=>er(eG.port,eN,200)),disabled:"buzzer-beep"===ew,children:[(0,t.jsx)(P.A,{className:"h-4 w-4 mr-2"}),"Beep"]}),(0,t.jsxs)(d.$,{variant:"outline",className:"flex-1",onClick:()=>sr("buzzer-melody",()=>ed(eG.device_id||eG.port)),disabled:"buzzer-melody"===ew,children:[(0,t.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Melody"]}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("buzzer-off",()=>em(eG.device_id||eG.port)),disabled:"buzzer-off"===ew,children:(0,t.jsx)(eW.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(w.J,{children:["Frequency: ",eN," Hz"]}),(0,t.jsx)(b.A,{value:[eN],onValueChange:e=>{let[s]=e;return eb(s)},min:200,max:5e3,step:100,className:"mt-2"}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[(0,t.jsx)("span",{children:"200 Hz (Low)"}),(0,t.jsx)("span",{children:"2000 Hz"}),(0,t.jsx)("span",{children:"5000 Hz (High)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"mb-2 block",children:"Preset Tones"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{name:"C4",freq:262},{name:"E4",freq:330},{name:"G4",freq:392},{name:"C5",freq:523},{name:"Alert",freq:880},{name:"Warning",freq:1e3},{name:"Success",freq:1500},{name:"Error",freq:200}].map(e=>(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>{eb(e.freq),sr("tone-".concat(e.name),()=>er(eG.device_id||eG.port,e.freq,100))},children:e.name},e.name))})]})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Raw Command Interface"]}),(0,t.jsx)(c.BT,{children:"Send custom MDP commands to the device"})]}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("ping",()=>ex(eG.device_id||eG.port,"command","ping",{cmd:"ping"})),disabled:"ping"===ew,children:"ping"===ew?"...":"Ping"}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("get-sensors",()=>ex(eG.device_id||eG.port,"command","get_sensors",{cmd:"get_sensors"})),disabled:"get-sensors"===ew,children:"get-sensors"===ew?"...":"Get Sensors"}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("get-bme1",()=>ex(eG.device_id||eG.port,"command","get_bme1",{cmd:"get_bme1"})),disabled:"get-bme1"===ew,children:"get-bme1"===ew?"...":"BME688-1"}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>sr("get-bme2",()=>ex(eG.device_id||eG.port,"command","get_bme2",{cmd:"get_bme2"})),disabled:"get-bme2"===ew,children:"get-bme2"===ew?"...":"BME688-2"})]}),(0,t.jsx)("div",{className:"mt-2 text-xs text-muted-foreground",children:"Raw MDP commands sent directly to device. Check console for responses."})]})]})]}),(0,t.jsxs)(C.TabsContent,{value:"communication",className:"space-y-6",children:[eG&&(0,t.jsx)(ey,{deviceId:eG.device_id||eG.port,onCommand:eX}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-green-500/20",children:(0,t.jsx)(R.A,{className:"h-5 w-5 text-green-500"})}),"LoRa Radio"]}),(0,t.jsxs)(A.E,{variant:"outline",className:"text-yellow-500",children:[(0,t.jsx)(H.A,{className:"h-3 w-3 mr-1"}),"Initializing"]})]}),(0,t.jsx)(c.BT,{children:"Long-range mesh communication for Side-A ↔ Side-B"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Frequency"}),(0,t.jsx)("p",{className:"text-lg font-mono font-bold",children:"915 MHz"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Spreading Factor"}),(0,t.jsx)("p",{className:"text-lg font-mono font-bold",children:"SF7"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"TX Power"}),(0,t.jsx)("p",{className:"text-lg font-mono font-bold",children:"20 dBm"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Bandwidth"}),(0,t.jsx)("p",{className:"text-lg font-mono font-bold",children:"125 kHz"})]})]}),(0,t.jsx)(eo.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"LoRa Commands"}),(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>sr("lora-ping",()=>ex(eG.device_id||eG.port,"command","lora_ping",{cmd:"lora ping"})),disabled:"lora-ping"===ew,children:[(0,t.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Ping Side-B"]}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>sr("lora-status",()=>ex(eG.device_id||eG.port,"command","lora_status",{cmd:"lora status"})),disabled:"lora-status"===ew,children:"Status"}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>sr("lora-send",()=>ex(eG.device_id||eG.port,"command","lora_send",{cmd:"lora send hello"})),disabled:"lora-send"===ew,children:"Send Test"})]})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20 text-sm",children:[(0,t.jsx)("p",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:"LoRa Module Status"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"LoRa radio module detected. Configure Side-A and Side-B for mesh communication."})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-blue-500/20",children:(0,t.jsx)(ej.A,{className:"h-5 w-5 text-blue-500"})}),"WiFi"]}),(0,t.jsxs)(A.E,{variant:"outline",className:"text-muted-foreground",children:[(0,t.jsx)(eL.A,{className:"h-3 w-3 mr-1"}),"Not Connected"]})]}),(0,t.jsx)(c.BT,{children:"ESP32-S3 built-in WiFi for cloud connectivity"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"SSID"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"—"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Signal"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"—"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"IP Address"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"—"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"MAC"}),(0,t.jsx)("p",{className:"text-sm font-mono",children:"—"})]})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/20 text-sm",children:[(0,t.jsx)("p",{className:"font-medium text-blue-600 dark:text-blue-400",children:"WiFi Ready"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"ESP32-S3 WiFi available. Configure credentials to enable cloud sync."})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-indigo-500/20",children:(0,t.jsx)(R.A,{className:"h-5 w-5 text-indigo-500"})}),"Bluetooth LE"]}),(0,t.jsxs)(A.E,{variant:"outline",className:"text-muted-foreground",children:[(0,t.jsx)(H.A,{className:"h-3 w-3 mr-1"}),"Available"]})]}),(0,t.jsx)(c.BT,{children:"Low-energy Bluetooth for mobile app connectivity"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Device Name"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"MycoBrain-01"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Paired Devices"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"0"})]})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-indigo-500/10 border border-indigo-500/20 text-sm",children:[(0,t.jsx)("p",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:"BLE Ready"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Enable BLE advertising to connect via mobile app."})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-purple-500/20",children:(0,t.jsx)(H.A,{className:"h-5 w-5 text-purple-500"})}),"Mesh Network"]}),(0,t.jsx)(A.E,{variant:"outline",className:"text-muted-foreground",children:"1 Node"})]}),(0,t.jsx)(c.BT,{children:"ESP-NOW mesh for local device coordination"})]}),(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Network ID"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"MYCO-001"})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"Nodes Online"}),(0,t.jsx)("p",{className:"text-lg font-mono",children:"1"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(w.J,{children:"Mesh Nodes"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded bg-green-500/10 border border-green-500/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),(0,t.jsx)("span",{className:"font-mono text-sm",children:"Side-A (This Device)"})]}),(0,t.jsx)(A.E,{variant:"outline",className:"text-green-500",children:"Online"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded bg-muted border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400"}),(0,t.jsx)("span",{className:"font-mono text-sm",children:"Side-B"})]}),(0,t.jsx)(A.E,{variant:"outline",className:"text-muted-foreground",children:"Searching..."})]})]})]})]})]})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Communication Log"]}),(0,t.jsx)(c.BT,{children:"Recent LoRa and mesh network messages"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsx)(m.F,{className:"h-[200px] rounded-md border p-4 bg-black/50",children:(0,t.jsxs)("div",{className:"font-mono text-xs text-green-400 space-y-1",children:[(0,t.jsxs)("p",{children:["[",new Date().toLocaleTimeString(),"] LORA: Module initialized @ 915MHz"]}),(0,t.jsxs)("p",{children:["[",new Date().toLocaleTimeString(),"] MESH: ESP-NOW started, MAC: ",(null===(h=eG.device_info)||void 0===h?void 0:h.mac_address)||"10:B4:1D:E3:3B:88"]}),(0,t.jsxs)("p",{children:["[",new Date().toLocaleTimeString(),"] MESH: Listening for peers..."]}),(0,t.jsxs)("p",{className:"text-yellow-400",children:["[",new Date().toLocaleTimeString(),"] LORA: Waiting for Side-B connection"]})]})})})]})]}),(0,t.jsxs)(C.TabsContent,{value:"analytics",className:"space-y-6",children:[eG&&(0,t.jsx)(eA,{deviceId:eG.device_id||eG.port}),eG&&(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsx)(ec,{deviceId:eG.device_id||eG.port,pollInterval:2e3,maxPoints:50}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{children:["Sensor History (Last ",eV.length," readings)"]}),(0,t.jsx)(c.BT,{children:"Real-time sensor data trends"})]}),(0,t.jsx)(c.Wu,{children:eV.length>0?(0,t.jsx)("div",{className:"h-64 flex items-end gap-1",children:eV.map((e,s)=>(0,t.jsx)("div",{className:"flex-1 bg-gradient-to-t from-green-500 to-green-400 rounded-t",style:{height:"".concat(e.bme1_temp/50*100,"%")},title:"".concat(e.bme1_temp.toFixed(1),"\xb0C at ").concat(e.timestamp.toLocaleTimeString())},s))}):(0,t.jsx)("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Collecting data..."})})]})]})]}),(0,t.jsx)(C.TabsContent,{value:"console",children:(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Device Console"]}),(0,t.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>eq([]),children:"Clear"})]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(m.F,{className:"h-96 rounded-lg bg-black p-4 font-mono text-sm text-green-400",children:[0===eS.length?(0,t.jsxs)("div",{className:"text-muted-foreground",children:[(0,t.jsxs)("p",{children:["MycoBrain Console - ",eG.port]}),(0,t.jsx)("p",{children:"---"}),(0,t.jsx)("p",{children:"Ready for commands..."})]}):eS.map((e,s)=>(0,t.jsx)("div",{children:e},s)),(0,t.jsx)("div",{className:"animate-pulse",children:"_"})]})})]})}),(0,t.jsxs)(C.TabsContent,{value:"config",className:"space-y-6",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsx)(c.ZB,{children:"Device Information"})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Port"}),(0,t.jsx)("p",{className:"font-mono",children:eG.port})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"MDP Version"}),(0,t.jsxs)("p",{className:"font-mono",children:["v",(null===(p=eG.device_info)||void 0===p?void 0:p.mdp_version)||1]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Firmware"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(j=eG.device_info)||void 0===j?void 0:j.firmware_version)||"1.0.0"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Board Type"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(y=eG.device_info)||void 0===y?void 0:y.board_type)||"ESP32-S3"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"MAC Address"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(S=eG.device_info)||void 0===S?void 0:S.mac_address)||"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Status"}),(0,t.jsx)("p",{className:"font-mono capitalize",children:(null===(_=eG.device_info)||void 0===_?void 0:_.status)||"ready"})]})]})})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsx)(c.ZB,{children:"Capabilities"})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(null===(E=eG.capabilities)||void 0===E?void 0:E.bme688_count)&&(0,t.jsxs)(A.E,{children:["BME688 x",eG.capabilities.bme688_count]}),(null===(B=eG.capabilities)||void 0===B?void 0:B.has_lora)&&(0,t.jsx)(A.E,{children:"LoRa SX1262"}),(null===(M=eG.capabilities)||void 0===M?void 0:M.has_neopixel)&&(0,t.jsx)(A.E,{children:"NeoPixel RGB"}),(null===(O=eG.capabilities)||void 0===O?void 0:O.has_buzzer)&&(0,t.jsx)(A.E,{children:"Buzzer"}),(null===(L=eG.capabilities)||void 0===L?void 0:L.i2c_bus)&&(0,t.jsx)(A.E,{children:"I2C Bus"}),(null===(F=eG.capabilities)||void 0===F?void 0:F.analog_inputs)&&(0,t.jsxs)(A.E,{variant:"outline",children:["Analog x",eG.capabilities.analog_inputs]}),(null===(D=eG.capabilities)||void 0===D?void 0:D.digital_io)&&(0,t.jsxs)(A.E,{variant:"outline",children:["Digital IO x",eG.capabilities.digital_io]})]})})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsx)(c.ZB,{children:"Location (GPS)"}),(0,t.jsx)(c.BT,{children:(null===(U=eG.location)||void 0===U?void 0:U.source)==="gps"?"Location from onboard GPS":"Manual location (GPS not connected)"})]}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Latitude"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(J=eG.location)||void 0===J?void 0:null===($=J.lat)||void 0===$?void 0:$.toFixed(6))||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Longitude"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(q=eG.location)||void 0===q?void 0:null===(W=q.lng)||void 0===W?void 0:W.toFixed(6))||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Source"}),(0,t.jsx)("p",{className:"font-mono capitalize",children:(null===(V=eG.location)||void 0===V?void 0:V.source)||"unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Accuracy"}),(0,t.jsx)("p",{className:"font-mono",children:(null===(G=eG.location)||void 0===G?void 0:G.accuracy)?"".concat(eG.location.accuracy,"m"):"—"})]})]})})]})]}),(0,t.jsxs)(C.TabsContent,{value:"diagnostics",className:"space-y-6",children:[(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(ez.A,{className:"h-5 w-5"}),"System Diagnostics"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:sx,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Run Diagnostics"]})]})}),(0,t.jsx)(c.Wu,{children:ss?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Service Status"}),(0,t.jsx)("p",{className:"font-mono",children:ss.service_status||"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Port Status"}),(0,t.jsx)("p",{className:"font-mono",children:"string"==typeof ss.port_status?ss.port_status:JSON.stringify(ss.port_status)||"Unknown"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Connection Status"}),(0,t.jsx)("p",{className:"font-mono",children:eG.connected?"Connected":"Disconnected"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Last Message"}),(0,t.jsx)("p",{className:"font-mono text-xs",children:eG.last_message_time||"Never"})]})]}),ss.errors&&ss.errors.length>0&&(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/50",children:[(0,t.jsx)(w.J,{className:"text-red-500",children:"Errors"}),(0,t.jsx)("ul",{className:"list-disc list-inside text-sm text-red-400 mt-2",children:ss.errors.map((e,s)=>(0,t.jsx)("li",{children:e},s))})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-muted",children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Full Diagnostics"}),(0,t.jsx)("pre",{className:"text-xs font-mono mt-2 overflow-auto",children:JSON.stringify(ss,null,2)})]})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(ez.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:'Click "Run Diagnostics" to check system status'})]})})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(eE.A,{className:"h-4 w-4"}),"Port Status"]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsx)("div",{className:"space-y-2",children:e4.length>0?e4.map(e=>{let s=e.path||e.port||e.id||"unknown",a=e3[s];return(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.is_connected?(0,t.jsx)(g.A,{className:"h-4 w-4 text-green-500"}):"locked"===a?(0,t.jsx)(eB.A,{className:"h-4 w-4 text-red-500"}):(0,t.jsx)(eM.A,{className:"h-4 w-4 text-gray-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-mono font-medium",children:s}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description||"Unknown device"})]})]}),(0,t.jsx)(A.E,{variant:e.is_connected?"default":"locked"===a?"destructive":"secondary",children:e.is_connected?"Connected":"locked"===a?"Locked":"Available"})]},s)}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:'No ports detected. Click "Refresh Ports" to scan.'})})})]}),(0,t.jsxs)(c.Zp,{children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(e_.A,{className:"h-4 w-4"}),"Service Management"]})}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("start"),disabled:"online"===e2,children:[(0,t.jsx)(eT.A,{className:"h-4 w-4 mr-2"}),"Start Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("stop"),disabled:"offline"===e2,children:[(0,t.jsx)(eR.A,{className:"h-4 w-4 mr-2"}),"Stop Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("kill"),disabled:"offline"===e2,className:"text-red-500 hover:text-red-600",children:[(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Kill Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("restart"),children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Restart Service"]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)(w.J,{className:"text-muted-foreground",children:"Service Status"}),(0,t.jsx)("div",{className:"mt-2 px-3 py-2 rounded-lg text-sm flex items-center gap-2 ".concat("online"===e2?"bg-green-500/20 text-green-500 border border-green-500/50":"offline"===e2?"bg-red-500/20 text-red-500 border border-red-500/50":"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50"),children:"online"===e2?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.A,{className:"h-4 w-4"}),"MycoBrain service is running on port 8003"]}):"offline"===e2?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ek.A,{className:"h-4 w-4"}),"MycoBrain service is not running"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin"}),"Checking service status..."]})})]})]})]})]}),(0,t.jsx)(C.TabsContent,{value:"firmware",className:"space-y-4",children:(0,t.jsx)(N,{})})]})]}):(0,t.jsx)(c.Zp,{className:"border-dashed",children:(0,t.jsxs)(c.Wu,{className:"flex flex-col items-center justify-center py-16",children:[(0,t.jsx)(x.A,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No MycoBrain Connected"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center mb-6 max-w-md",children:"Connect a MycoBrain device via USB to monitor sensors, control peripherals, and view real-time data."}),(0,t.jsx)("div",{className:"mb-4 px-4 py-2 rounded-lg text-sm flex items-center gap-2 ".concat("online"===e2?"bg-green-500/20 text-green-500 border border-green-500/50":"offline"===e2?"bg-red-500/20 text-red-500 border border-red-500/50":"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50"),children:"online"===e2?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.A,{className:"h-4 w-4"}),"MycoBrain service is running"]}):"offline"===e2?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ek.A,{className:"h-4 w-4"}),"MycoBrain service not running - Start: python services/mycobrain/mycobrain_service.py"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin"}),"Checking service status..."]})}),Q&&(0,t.jsxs)("div",{className:"mb-4 p-3 rounded-lg text-sm bg-red-500/20 text-red-500 border border-red-500/50",children:[(0,t.jsx)(ek.A,{className:"h-4 w-4 inline mr-2"}),Q]}),eQ&&(0,t.jsx)("div",{className:"mb-4 p-3 rounded-lg text-sm ".concat(eQ.includes("Successfully")?"bg-green-500/20 text-green-500 border border-green-500/50":"bg-yellow-500/20 text-yellow-500 border border-yellow-500/50"),children:eQ}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)(d.$,{onClick:sd,disabled:eK||"offline"===e2,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2 ".concat(eK?"animate-spin":"")}),eK?"Scanning...":"Scan for Devices"]}),(0,t.jsxs)(d.$,{variant:"outline",onClick:ea,children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),(0,t.jsxs)(c.Zp,{className:"mt-6",children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(e_.A,{className:"h-4 w-4"}),"Service Management"]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("start"),disabled:"online"===e2,children:[(0,t.jsx)(eT.A,{className:"h-4 w-4 mr-2"}),"Start Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("stop"),disabled:"offline"===e2,children:[(0,t.jsx)(eR.A,{className:"h-4 w-4 mr-2"}),"Stop Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("kill"),disabled:"offline"===e2,className:"text-red-500 hover:text-red-600",children:[(0,t.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"Kill Service"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>so("restart"),children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Restart Service"]})]})})]}),(0,t.jsxs)(c.Zp,{className:"mt-4",children:[(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(eE.A,{className:"h-4 w-4"}),"Port Selection"]}),(0,t.jsx)(c.BT,{children:"Select a COM port to connect to"})]}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4",children:["COM3","COM4","COM5","COM6"].map(e=>{let s=e4.find(s=>s.port===e),a=e3[e]||((null==s?void 0:s.is_connected)?"connected":s?"available":"unknown"),n="locked"===a;return(0,t.jsxs)(d.$,{variant:"connected"===a?"default":n?"destructive":"outline",size:"sm",className:"relative",onClick:async()=>{if(n){eX("⚠ Port ".concat(e," is locked. Attempting to clear...")),await sm();return}eY(!0),e0(null),eX("> Connecting to ".concat(e,"..."));try{let n=await fetch("/api/mycobrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"connect",port:e}),signal:AbortSignal.timeout(15e3)}),i=await n.json();if(i.success||"connected"===i.status){e0("Successfully connected to ".concat(e,"!")),eX("✓ Connected to ".concat(e)),eh(e);let n=i.device_id||e;try{let i=await fetch("/api/mycobrain/".concat(encodeURIComponent(n),"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_id:n,port:e,serial_number:n,firmware_version:"unknown"}),signal:AbortSignal.timeout(5e3)});if(i.ok){var s,a,t,l;let e=await i.json();eX("✓ Device registered: MINDEX=".concat((null===(a=e.registrations)||void 0===a?void 0:null===(s=a.mindex)||void 0===s?void 0:s.status)||"N/A",", NatureOS=").concat((null===(l=e.registrations)||void 0===l?void 0:null===(t=l.natureos)||void 0===t?void 0:t.status)||"N/A"))}}catch(e){eX("⚠ Registration failed (non-critical): ".concat(e))}await new Promise(e=>setTimeout(e,500)),await ea()}else{let s=i.message||i.error||i.detail||"Unknown error";e0("Failed to connect to ".concat(e,": ").concat(s)),eX("✗ Connection failed: ".concat(s)),(s.includes("locked")||s.includes("in use"))&&e8(s=>({...s,[e]:"locked"}))}}catch(s){"AbortError"===s.name?(e0("Connection to ".concat(e," timed out (port may be locked)")),eX("✗ Connection timeout - port may be locked"),e8(s=>({...s,[e]:"locked"}))):(e0("Error connecting to ".concat(e,": ").concat(s)),eX("✗ Error: ".concat(s)))}finally{eY(!1)}},disabled:eK||"offline"===e2,children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["connected"===a&&(0,t.jsx)(g.A,{className:"h-3 w-3"}),n&&(0,t.jsx)(eB.A,{className:"h-3 w-3"}),"available"===a&&(0,t.jsx)(eM.A,{className:"h-3 w-3"}),e]}),n&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 h-2 w-2 bg-red-500 rounded-full animate-pulse"})]},e)})}),Object.values(e3).some(e=>"locked"===e)&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:sm,className:"text-orange-500",children:[(0,t.jsx)(eO.A,{className:"h-4 w-4 mr-2"}),"Clear Port Locks"]})})]})]}),(0,t.jsxs)(c.Zp,{className:"mt-4",children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(ez.A,{className:"h-4 w-4"}),"Diagnostics & Debugging"]})}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:sx,children:[(0,t.jsx)(ez.A,{className:"h-4 w-4 mr-2"}),"Run Diagnostics"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:sm,children:[(0,t.jsx)(eO.A,{className:"h-4 w-4 mr-2"}),"Clear All Locks"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:async()=>{eX("> Fetching available ports...");try{let a=await fetch("/api/mycobrain/ports",{signal:AbortSignal.timeout(5e3)});if(a.ok){var e,s;let t=await a.json();e1(t.ports||[]),eX("✓ Found ".concat((null===(e=t.ports)||void 0===e?void 0:e.length)||0," port(s)")),null===(s=t.ports)||void 0===s||s.forEach(e=>{eX("  - ".concat(e.port,": ").concat(e.description||"Unknown"," (Connected: ").concat(e.is_connected,")"))})}}catch(e){eX("✗ Failed to fetch ports: ".concat(e))}},children:[(0,t.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"Refresh Ports"]})]}),ss&&(0,t.jsx)("div",{className:"mt-4 p-3 rounded-lg bg-muted text-xs font-mono",children:(0,t.jsx)("pre",{children:JSON.stringify(ss,null,2)})})]})]}),(0,t.jsxs)(c.Zp,{className:"mt-4",children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.ZB,{className:"text-base flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4"}),"Console Output"]}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>eq([]),children:[(0,t.jsx)(eP.A,{className:"h-4 w-4 mr-2"}),"Clear"]})]})}),(0,t.jsx)(c.Wu,{children:(0,t.jsxs)(m.F,{className:"h-48 rounded-lg bg-black p-4 font-mono text-sm text-green-400",children:[0===eS.length?(0,t.jsxs)("div",{className:"text-muted-foreground",children:[(0,t.jsx)("p",{children:"MycoBrain Device Manager Console"}),(0,t.jsx)("p",{children:"---"}),(0,t.jsx)("p",{children:"Ready for commands..."})]}):eS.map((e,s)=>(0,t.jsx)("div",{children:e},s)),(0,t.jsx)("div",{className:"animate-pulse",children:"_"})]})})]})]})})}var eV=a(76046);function eH(){let e=(0,eV.useSearchParams)().get("device");return(0,t.jsx)(eq,{initialPort:e||void 0})}function eG(){return(0,t.jsxs)(l.R,{children:[(0,t.jsx)(n.a,{heading:"Device Manager",text:"Monitor and control your MycoBrain devices and connected sensors"}),(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)("div",{className:"text-center py-8",children:"Loading device manager..."}),children:(0,t.jsx)(eH,{})})]})}},89592:(e,s,a)=>{"use strict";a.d(s,{k:()=>i});var t=a(95155);a(12115);var n=a(22263),l=a(29602);function i(e){let{className:s,value:a,...i}=e;return(0,t.jsx)(n.bL,{"data-slot":"progress",className:(0,l.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...i,children:(0,t.jsx)(n.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})}},63230:(e,s,a)=>{"use strict";a.d(s,{O7:()=>l,Y0:()=>i,oX:()=>n});var t=a(12115);function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,[s,a]=(0,t.useState)({devices:[],loading:!0,error:null,lastUpdate:null,isConnected:!1}),n=(0,t.useRef)(!0),l=(0,t.useRef)(null),i=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/mycobrain",{signal:AbortSignal.timeout(5e3)});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.message||s.error||"Failed to fetch devices")}let s=await e.json();if(s.error){n.current&&a(e=>({...e,loading:!1,error:s.message||s.error,lastUpdate:new Date,devices:e.devices,isConnected:e.devices.some(e=>e.connected)}));return}let t=(s.devices||[]).map(e=>{var s,a;return{...e,device_id:e.device_id||"mycobrain-".concat((null===(s=e.port)||void 0===s?void 0:s.replace(/[\/\\]/g,"-"))||"unknown"),connected:null!==(a=e.connected)&&void 0!==a?a:"connected"===e.status,capabilities:e.capabilities||{bme688_count:2,has_lora:!0,has_neopixel:!0,has_buzzer:!0,i2c_bus:!0,analog_inputs:4,digital_io:4},location:e.location||{lat:40.7128,lng:-74.006,source:"manual"}}});n.current&&a(e=>({...e,devices:t,loading:!1,error:null,lastUpdate:new Date,isConnected:t.some(e=>e.connected)}))}catch(e){n.current&&a(s=>({...s,loading:!1,error:e instanceof Error?e.message:"Unknown error",devices:s.devices.length>0?s.devices:[]}))}},[]),r=(0,t.useCallback)(async e=>{try{let t=s.devices.find(s=>s.port===e||s.device_id===e),l=(null==t?void 0:t.device_id)||e,i=await fetch("/api/mycobrain/".concat(encodeURIComponent(l),"/sensors"));if(!i.ok)throw Error("Failed to fetch sensors");let r=await i.json();return n.current&&a(s=>({...s,devices:s.devices.map(s=>s.port===e||s.device_id===e?{...s,sensor_data:{...s.sensor_data,...r.sensors}}:s),lastUpdate:new Date})),r.sensors}catch(e){return null}},[s.devices]),c=(0,t.useCallback)(async function(e,a,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{let l=s.devices.find(s=>s.port===e),i=(null==l?void 0:l.device_id)||e,r=await fetch("/api/mycobrain/".concat(encodeURIComponent(i),"/control"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({peripheral:a,action:t,...n})});if(!r.ok)throw Error("Control command failed");return await r.json()}catch(e){throw e}},[s.devices]),d=(0,t.useCallback)(async function(e,s,a,t){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128;return c(e,"neopixel","solid",{r:s,g:a,b:t,brightness:n})},[c]),o=(0,t.useCallback)(async e=>c(e,"neopixel","rainbow"),[c]),m=(0,t.useCallback)(async e=>c(e,"neopixel","off"),[c]),x=(0,t.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return c(e,"buzzer","beep",{frequency:s,duration_ms:a})},[c]),u=(0,t.useCallback)(async e=>c(e,"buzzer","melody"),[c]),h=(0,t.useCallback)(async e=>c(e,"buzzer","off"),[c]),p=(0,t.useCallback)(()=>{i(),s.devices.forEach(e=>{e.connected&&r(e.port)})},[i,r,s.devices]);return(0,t.useEffect)(()=>(n.current=!0,i(),l.current=setInterval(()=>{i()},e),()=>{n.current=!1,l.current&&clearInterval(l.current)}),[i,e]),(0,t.useEffect)(()=>{s.devices.filter(e=>e.connected).forEach(e=>r(e.port))},[s.devices.filter(e=>e.connected).length,r]),{...s,refresh:p,fetchSensors:r,sendControl:c,setNeoPixel:d,neoPixelRainbow:o,neoPixelOff:m,buzzerBeep:x,buzzerMelody:u,buzzerOff:h}}function l(e){return e?e<=50?{label:"Excellent",color:"text-green-500",bgColor:"bg-green-500/20"}:e<=100?{label:"Good",color:"text-green-400",bgColor:"bg-green-400/20"}:e<=150?{label:"Moderate",color:"text-yellow-500",bgColor:"bg-yellow-500/20"}:e<=200?{label:"Poor",color:"text-orange-500",bgColor:"bg-orange-500/20"}:e<=300?{label:"Unhealthy",color:"text-red-500",bgColor:"bg-red-500/20"}:{label:"Hazardous",color:"text-purple-500",bgColor:"bg-purple-500/20"}:{label:"Unknown",color:"text-gray-500",bgColor:"bg-gray-500/20"}}function i(e){if(!e)return"—";let s=Math.floor(e/86400),a=Math.floor(e%86400/3600),t=Math.floor(e%3600/60);return s>0?"".concat(s,"d ").concat(a,"h"):a>0?"".concat(a,"h ").concat(t,"m"):"".concat(t,"m")}}},e=>{var s=s=>e(e.s=s);e.O(0,[9440,9116,8629,6238,9895,4226,4741,5900,6112,3384,5312,8441,1517,7358],()=>s(57487)),_N_E=e.O()}]);