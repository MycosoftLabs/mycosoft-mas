---
description: Autostart background services registry and protocol for all agents
alwaysApply: true
---

# Autostart Services Registry (All Agents)

## Registered Autostart Services

These scripts/services must be running for the full Mycosoft development system to work. Agents should check and restart them when needed.

| # | Service | Script | Purpose | Check Command | Start Command |
|---|---------|--------|---------|---------------|---------------|
| 1 | **MycoBrain Service** | `services/mycobrain/mycobrain_service_standalone.py` | **24/7/365 ALWAYS-ON** - Serial comms, MAS heartbeats, network device visibility | `.\scripts\mycobrain-service.ps1 health` | `.\scripts\mycobrain-service.ps1 start` |
| 2 | Notion Docs Watcher | `scripts/notion_docs_watcher.py` | Auto-syncs new/changed .md docs across all repos to Notion | `.\scripts\notion-sync.ps1 status` | `.\scripts\notion-sync.ps1 watch-bg` |
| 3 | Cursor Chat Backup | `scripts/cursor-chat-backup.ps1` | Daily midnight backup of all chats, agents, plans, skills, rules | `schtasks /query /tn Mycosoft-CursorChatBackup` | `.\scripts\cursor-chat-backup.ps1 -Schedule` |
| 4 | **Cursor System Sync** | `scripts/sync_cursor_system.py` | Syncs rules/agents/skills from ALL repos to user Cursor system every 30s so all agents can talk to sub-agents, use all rules, and have context | `Get-Process python \| Where-Object {$_.CommandLine -like '*sync_cursor_system*'}` | `python scripts/sync_cursor_system.py --watch` |
| 5 | **n8n Local (Docker)** | Docker container `mycosoft-n8n` | **CRITICAL** - Workflow automation, webhooks, MAS integrations. Requires Docker Desktop running. | `.\scripts\n8n-healthcheck.ps1` | `.\scripts\n8n-healthcheck.ps1 -StartDocker -StartLocal` |
| 6 | **Docker Healthcheck** | `scripts/docker-healthcheck.ps1` | Periodic Docker cleanup - removes stopped containers, dangling images, unused volumes. Reports to MAS. | `.\scripts\docker-healthcheck.ps1 -Quick` | `.\scripts\docker-healthcheck.ps1 -Cleanup` |

**CRITICAL:** MycoBrain Service (#1) and n8n (#5) must ALWAYS be running. If down, restart immediately.
**CRITICAL:** n8n requires Docker Desktop. If Docker is not running, start it first with `.\scripts\docker-healthcheck.ps1 -StartDocker`.
**PERIODIC:** Docker Healthcheck (#6) should run every 30 minutes during active sessions to prevent resource waste.

## Optional GPU Voice Services (Start when voice features needed)

These services require GPU and should ONLY be started when voice features are actively being used. Kill them when done to free resources.

| # | Service | Port | Script | Purpose | Check Command | Start Command |
|---|---------|------|--------|---------|---------------|---------------|
| 4 | Moshi TTS/STT Server | 8998 | `scripts/start_moshi_server.py` | Native voice TTS/STT with GPU acceleration | `curl -s http://localhost:8998/health` | `python scripts/start_moshi_server.py` |
| 5 | PersonaPlex Bridge | 8999 | `services/personaplex-local/personaplex_bridge_nvidia.py` | Bridges Moshi to WebSocket for browser | `curl -s http://localhost:8999/health` | `python services/personaplex-local/personaplex_bridge_nvidia.py` |

**WARNING:** GPU services use ~23GB+ VRAM combined. Only start when needed and KILL when done using `scripts/dev-machine-cleanup.ps1 -KillStaleGPU`.

## Optional: Gap Report for Cursor (all chats)

Refreshes `.cursor/gap_report_latest.json` so the Gap Agent rule and @gap-agent have a recent scan in every chat without calling MAS every time.

| # | Service | Script | Purpose | Check Command | Start Command |
|---|---------|--------|---------|---------------|---------------|
| 6 | Gap Scan (Cursor) | `scripts/gap_scan_cursor_background.py` | Writes latest gap report for Cursor gap-agent rule | Test: file exists `.cursor/gap_report_latest.json` | `python scripts/gap_scan_cursor_background.py` (run every 15â€“30 min via Task Scheduler or manually) |

To run in background on a schedule: create a Windows Task or run `python scripts/gap_scan_cursor_background.py` periodically. Optional; if not run, Cursor will use MAS API or local scan when gap-agent is invoked.

## Agent Protocol

### On session start
- Periodically check that all registered autostart services are running.
- If a service is down, restart it automatically and note it in your response.

### When creating new background scripts
- **Ask the user:** "Should this be added to the autostart services list?"
- If yes, add it to the table above with: script path, purpose, check command, and start command.
- Also add the health check to `scripts/autostart-healthcheck.ps1`.

### Periodic health checks
- When working on long tasks, check autostart services every ~30 minutes.
- If a service crashed or is causing high CPU/memory, stop it, report to the user, and investigate.
- Use `scripts/autostart-healthcheck.ps1` for a quick all-in-one check.

### Performance awareness
- Autostart services should be lightweight. If any service uses >200MB RAM or >5% sustained CPU, flag it.
- Cross-reference with `dev-machine-performance.mdc` rules - do not let background services make the machine slow.
- Cross-reference with `python-process-registry.mdc` for full process/port/resource map before starting anything.

### Kill zombie processes
- When checking autostart health, also look for zombie GPU processes (PersonaPlex, Earth2, Moshi) that should NOT be running and kill them.
- Run `scripts/dev-machine-cleanup.ps1 -KillStaleGPU` if any GPU processes are found running without user request.

### Specialized agents for service management
Use these sub-agents for service-specific tasks:
- `device-firmware` -- **MycoBrain service lifecycle, firmware, serial ports**
- `n8n-ops` -- **n8n health, Docker Desktop, local/VM sync, workflow automation**
- `docker-ops` -- **Docker Desktop resource management, container cleanup, image pruning, MAS integration**
- `process-manager` -- GPU cleanup, port conflicts, resource issues
- `deploy-pipeline` -- Deployment automation
- `notion-sync` -- Notion watcher management
- `backup-ops` -- Backup scheduled task verification
- `infrastructure-ops` -- VM and Docker container health

### MycoBrain Service Priority
The MycoBrain service is **Priority 1** - it must run 24/7/365:
1. Check it FIRST on every session start
2. If down, start it BEFORE any other work
3. After debugging firmware/service, ALWAYS restart it
4. Use scheduled task for boot auto-start: `.\scripts\mycobrain-service.ps1 -Schedule`

## Quick Reference

```powershell
# Check all autostart services
.\scripts\autostart-healthcheck.ps1

# Start all autostart services
.\scripts\autostart-healthcheck.ps1 -StartMissing

# Stop all autostart services
.\scripts\autostart-healthcheck.ps1 -StopAll
```
