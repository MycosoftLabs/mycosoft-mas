---
description: Security rule - NEVER hardcode secrets, passwords, or API keys in any file
alwaysApply: true
---

# NO HARDCODED SECRETS — All Agents (Critical Security Rule)

## THIS IS A SECURITY VIOLATION

Hardcoding credentials, passwords, API keys, or tokens in ANY file — Python, TypeScript, shell, docs, markdown, config — is a critical security violation. It exposes secrets via git history even after removal.

**This already happened and caused a full security incident. Every agent must follow these rules going forward.**

---

## Secrets That Were Exposed (now rotated — never use again)

These old values are REVOKED. Never type them. If you see them anywhere, delete them:
- Old MINDEX DB password: `mycosoft_mindex_2026` → now `Diamond1!` (env var only)
- Old NCBI API key: `eb2264e1bc6f521cf2bcf7fc5f32447a7108` → rotated (env var only)
- VM SSH password: `Mushroom1!Mushroom1!` → **DO NOT COMMIT THIS ANYWHERE**
- NGC key: `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` → revoked

---

## Required Pattern — Always Use env vars

### Python
```python
import os

# CORRECT
password = os.environ.get("VM_PASSWORD", "")
db_pass = os.environ.get("MINDEX_DB_PASSWORD", "")
api_key = os.environ.get("NCBI_API_KEY", "")

# WRONG — never do this
password = "Mushroom1!Mushroom1!"  # ← VIOLATION
db_pass = "Diamond1!"             # ← VIOLATION
```

### SSH/paramiko — ALWAYS use env vars
```python
import os, paramiko

ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
ssh.connect(
    host,
    username="mycosoft",
    password=os.environ.get("VM_PASSWORD", ""),  # CORRECT
    timeout=30,
)
```

### PowerShell
```powershell
# CORRECT — read from env
$pass = $env:VM_PASSWORD

# WRONG
$pass = "Mushroom1!Mushroom1!"  # ← VIOLATION
```

### TypeScript/Next.js
```typescript
// CORRECT
const dbPassword = process.env.MINDEX_DB_PASSWORD
const apiKey = process.env.NCBI_API_KEY

// WRONG
const dbPassword = "Diamond1!"  // ← VIOLATION
```

---

## Rules for All Agents

1. **NEVER write a literal password, key, or token in code, docs, scripts, or config files.**
2. **NEVER commit .env, .env.local, .credentials, or any file with real secrets.**
3. **Always use `os.environ.get()` (Python), `process.env` (TS/JS), or `$env:` (PowerShell).**
4. **For new scripts needing SSH:** read `os.environ.get("VM_PASSWORD", "")`. Never hardcode the value.
5. **For deployment docs:** use placeholder like `<VM_PASSWORD>` or `$env:VM_PASSWORD`, not the real value.
6. **If you see a hardcoded secret in existing code:** remove it, replace with env var, flag it to the user.
7. **Secrets go in `.env` files only** — and `.env` must be in `.gitignore`. Verify before committing.

---

## Where Secrets Live (read-only references)

| Secret | Env var name | Where set |
|--------|-------------|-----------|
| VM SSH password | `VM_PASSWORD` | Local `.env`, PowerShell `$env:VM_PASSWORD` |
| MINDEX DB password | `MINDEX_DB_PASSWORD` | VM `.env` files, local `.env` |
| NCBI API key | `NCBI_API_KEY` | VM `.env` files, local `.env` |
| NGC/NVIDIA key | `NGC_API_KEY` | VM `.env`, local `.env` |
| MAS API URL | `MAS_API_URL` | `.env.local` |
| MINDEX API URL | `MINDEX_API_URL` | `.env.local` |

---

## Pre-Commit Check

Before committing ANY code, scan for secrets:
```powershell
# Check for common patterns
git diff --cached | Select-String -Pattern "password\s*=\s*['\`"][^'`"\s]{4,}", "api_key\s*=\s*['\`"][^'`"\s]{8,}", "Mushroom1", "Diamond1"
```
If any match, **do not commit**. Remove the secret and use an env var instead.

---

## Violation Response

If a secret is committed:
1. **Rotate the secret immediately** — assume compromised
2. **Remove from working files** — replace with env var
3. **Purge from git history** — `git filter-repo --replace-text replacements.txt --force`
4. **Force push** — `git push origin main --force`
5. **Update all VMs** — re-deploy with new credentials
6. **Document** what was exposed and when
