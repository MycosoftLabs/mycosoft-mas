{
    "updatedAt":  "2025-12-20T07:28:10.025Z",
    "createdAt":  "2025-12-20T07:28:10.025Z",
    "id":  "GzO5wKliri3eZzBv",
    "name":  "Audit Logger",
    "description":  null,
    "active":  false,
    "isArchived":  false,
    "nodes":  [
                  {
                      "parameters":  {

                                     },
                      "id":  "audit-trigger",
                      "name":  "Execute Workflow Trigger",
                      "type":  "n8n-nodes-base.executeWorkflowTrigger",
                      "typeVersion":  1,
                      "position":  [
                                       240,
                                       300
                                   ]
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "// Prepare audit record\nconst crypto = require(\u0027crypto\u0027);\nconst input = $input.item.json;\n\n// Extract command data\nconst command = input.command || {};\nconst integration = input.integration || {};\nconst result = input.result || input;\n\n// Hash sensitive data\nconst paramsHash = crypto.createHash(\u0027sha256\u0027)\n  .update(JSON.stringify(command.params || {}))\n  .digest(\u0027hex\u0027);\n\nconst responseHash = crypto.createHash(\u0027sha256\u0027)\n  .update(JSON.stringify(result))\n  .digest(\u0027hex\u0027);\n\n// Determine status\nconst status = result.success === true ? \u0027success\u0027 : result.success === false ? \u0027error\u0027 : \u0027unknown\u0027;\n\nconst auditRecord = {\n  timestamp: new Date().toISOString(),\n  request_id: command.request_id || input.request_id || $execution.id,\n  actor: command.actor || \u0027system\u0027,\n  integration: integration.integration || integration || \u0027unknown\u0027,\n  action: command.action || \u0027unknown\u0027,\n  category: integration.category || null,\n  params_hash: paramsHash,\n  response_hash: responseHash,\n  status: status,\n  duration_ms: input.duration_ms || null,\n  error_message: result.error || result.message || null,\n  risk_level: integration.risk || input.risk_level || \u0027read_only\u0027,\n  confirmed: command.confirm === true,\n  correlation_id: command.correlation_id || command.request_id || $execution.id,\n  metadata: {\n    execution_id: $execution.id,\n    workflow_name: $workflow.name,\n    workflow_id: $workflow.id\n  }\n};\n\nreturn [{ json: auditRecord }];"
                                     },
                      "id":  "prepare-audit",
                      "name":  "Prepare Audit Record",
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       460,
                                       300
                                   ]
                  },
                  {
                      "parameters":  {
                                         "operation":  "insert",
                                         "schema":  "public",
                                         "table":  "myca_audit",
                                         "columns":  {
                                                         "mappingMode":  "defineBelow",
                                                         "value":  {
                                                                       "timestamp":  "={{ $json.timestamp }}",
                                                                       "request_id":  "={{ $json.request_id }}",
                                                                       "actor":  "={{ $json.actor }}",
                                                                       "integration":  "={{ $json.integration }}",
                                                                       "action":  "={{ $json.action }}",
                                                                       "category":  "={{ $json.category }}",
                                                                       "params_hash":  "={{ $json.params_hash }}",
                                                                       "response_hash":  "={{ $json.response_hash }}",
                                                                       "status":  "={{ $json.status }}",
                                                                       "duration_ms":  "={{ $json.duration_ms }}",
                                                                       "error_message":  "={{ $json.error_message }}",
                                                                       "risk_level":  "={{ $json.risk_level }}",
                                                                       "confirmed":  "={{ $json.confirmed }}",
                                                                       "correlation_id":  "={{ $json.correlation_id }}",
                                                                       "metadata":  "={{ $json.metadata }}"
                                                                   }
                                                     },
                                         "options":  {

                                                     }
                                     },
                      "id":  "write-postgres",
                      "name":  "Write to Postgres",
                      "type":  "n8n-nodes-base.postgres",
                      "typeVersion":  2.4,
                      "position":  [
                                       680,
                                       200
                                   ],
                      "credentials":  {
                                          "postgres":  {
                                                           "name":  "MYCA Postgres"
                                                       }
                                      }
                  },
                  {
                      "parameters":  {
                                         "operation":  "append",
                                         "fileName":  "/nas-logs/myca_audit.jsonl",
                                         "data":  "={{ JSON.stringify($json) + \u0027\\n\u0027 }}",
                                         "options":  {
                                                         "createIntermediateDirectories":  true
                                                     }
                                     },
                      "id":  "write-jsonl",
                      "name":  "Write to JSONL File",
                      "type":  "n8n-nodes-base.fs",
                      "typeVersion":  1,
                      "position":  [
                                       680,
                                       400
                                   ]
                  },
                  {
                      "parameters":  {
                                         "mode":  "combine",
                                         "combineBy":  "combineAll"
                                     },
                      "id":  "merge-audit",
                      "name":  "Merge Results",
                      "type":  "n8n-nodes-base.merge",
                      "typeVersion":  2.1,
                      "position":  [
                                       900,
                                       300
                                   ]
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "// Return audit confirmation\nconst input = $(\u0027Execute Workflow Trigger\u0027).item.json;\nconst audit = $(\u0027Prepare Audit Record\u0027).item.json;\n\nreturn [{\n  json: {\n    ...input,\n    audit_logged: true,\n    audit_request_id: audit.request_id,\n    audit_timestamp: audit.timestamp\n  }\n}];"
                                     },
                      "id":  "return-result",
                      "name":  "Return with Audit",
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       1120,
                                       300
                                   ]
                  }
              ],
    "connections":  {
                        "Execute Workflow Trigger":  {
                                                         "main":  [
                                                                      [
                                                                          {
                                                                              "node":  "Prepare Audit Record",
                                                                              "type":  "main",
                                                                              "index":  0
                                                                          }
                                                                      ]
                                                                  ]
                                                     },
                        "Prepare Audit Record":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Write to Postgres",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      },
                                                                      {
                                                                          "node":  "Write to JSONL File",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Write to Postgres":  {
                                                  "main":  [
                                                               [
                                                                   {
                                                                       "node":  "Merge Results",
                                                                       "type":  "main",
                                                                       "index":  0
                                                                   }
                                                               ]
                                                           ]
                                              },
                        "Write to JSONL File":  {
                                                    "main":  [
                                                                 [
                                                                     {
                                                                         "node":  "Merge Results",
                                                                         "type":  "main",
                                                                         "index":  1
                                                                     }
                                                                 ]
                                                             ]
                                                },
                        "Merge Results":  {
                                              "main":  [
                                                           [
                                                               {
                                                                   "node":  "Return with Audit",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ]
                                                       ]
                                          }
                    },
    "settings":  {
                     "executionOrder":  "v1",
                     "callerPolicy":  "workflowsFromSameOwner",
                     "availableInMCP":  false
                 },
    "staticData":  null,
    "meta":  null,
    "pinData":  null,
    "versionId":  "c8f05d94-20e1-4295-974a-ab514d580463",
    "activeVersionId":  null,
    "versionCounter":  1,
    "triggerCount":  0,
    "shared":  [
                   {
                       "updatedAt":  "2025-12-20T07:28:10.027Z",
                       "createdAt":  "2025-12-20T07:28:10.027Z",
                       "role":  "workflow:owner",
                       "workflowId":  "GzO5wKliri3eZzBv",
                       "projectId":  "2vYHfUSw9PyoLiDh",
                       "project":  {
                                       "updatedAt":  "2025-12-20T07:26:10.218Z",
                                       "createdAt":  "2025-12-20T07:24:36.044Z",
                                       "id":  "2vYHfUSw9PyoLiDh",
                                       "name":  "Morgan Mycosoft \u003cmorgan@mycosoft.org\u003e",
                                       "type":  "personal",
                                       "icon":  null,
                                       "description":  null,
                                       "projectRelations":  [
                                                                {
                                                                    "updatedAt":  "2025-12-20T07:24:36.044Z",
                                                                    "createdAt":  "2025-12-20T07:24:36.044Z",
                                                                    "userId":  "22c64709-d230-4f0d-bd7a-db86b3d3cc34",
                                                                    "projectId":  "2vYHfUSw9PyoLiDh",
                                                                    "user":  {
                                                                                 "updatedAt":  "2025-12-20T07:30:13.000Z",
                                                                                 "createdAt":  "2025-12-20T07:24:35.720Z",
                                                                                 "id":  "22c64709-d230-4f0d-bd7a-db86b3d3cc34",
                                                                                 "email":  "morgan@mycosoft.org",
                                                                                 "firstName":  "Morgan",
                                                                                 "lastName":  "Mycosoft",
                                                                                 "personalizationAnswers":  {
                                                                                                                "version":  "v4",
                                                                                                                "personalization_survey_submitted_at":  "2025-12-20T07:26:31.298Z",
                                                                                                                "personalization_survey_n8n_version":  "2.0.2",
                                                                                                                "companySize":  "\u003c20",
                                                                                                                "companyType":  "saas",
                                                                                                                "role":  "business-owner",
                                                                                                                "reportedSource":  "friend"
                                                                                                            },
                                                                                 "settings":  {
                                                                                                  "userActivated":  false
                                                                                              },
                                                                                 "disabled":  false,
                                                                                 "mfaEnabled":  false,
                                                                                 "lastActiveAt":  "2025-12-20",
                                                                                 "isPending":  false
                                                                             }
                                                                }
                                                            ]
                                   }
                   }
               ],
    "tags":  [

             ],
    "activeVersion":  null
}
